<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <!-- Font Awesome for icons -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyJtc4FZQ5nP3/h/4z1ypFJtW9r4C" crossorigin="anonymous" referrerpolicy="no-referrer" 
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyJtc4FZQ5nP3/h/4z1ypFJtW9r4C" />
  
  <!-- Libraries for report downloads -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
  <style>
    :root {
      --primary-color: #4f46e5;
      --primary-light: #818cf8;
      --primary-dark: #4338ca;
      --bg-color: #f8fafc;
      --sidebar-bg: #1e293b;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --card-bg: #ffffff;
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --transition: all 0.3s ease;
    }

    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f5f7fa;
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    ul {
      list-style: none;
    }

    /* Layout */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: #1e3a8a; /* Dark blue color */
      color: #e5e7eb; /* Light gray text for better contrast */
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      overflow-y: auto;
      transition: var(--transition);
      z-index: 1000;
      transform: translateX(-100%);
      box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .sidebar-logo {
      padding: 1.5rem 1.5rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo-icon {
      background: var(--primary-color);
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.25rem;
    }

    .sidebar-logo h2 {
      color: white;
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
      background: none;
      -webkit-text-fill-color: white;
    }

    .sidebar-profile {
      padding: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .profile-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      color: white;
    }

    .profile-info {
      flex: 1;
    }

    .profile-name {
      color: white;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .sidebar-menu {
      padding: 1rem 0;
    }

    .sidebar-menu li {
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #e5e7eb;
      transition: var(--transition);
      font-size: 0.95rem;
      font-weight: 500;
      border-left: 3px solid transparent;
    }

    .sidebar-menu li i {
      width: 24px;
      text-align: center;
      font-size: 1rem;
    }

    .sidebar-menu li:hover {
      background: rgba(255, 255, 255, 0.05);
      color: white;
      padding-left: 1.75rem;
    }

    .sidebar-menu li.active {
      background: rgba(79, 70, 229, 0.2);
      color: #a5b4fc;
      border-left-color: #6366f1;
    }

    .sidebar-menu li.active i {
      color: #a5b4fc;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 0;
      transition: var(--transition);
      min-height: 100vh;
      background: #f5f7fa;
      padding: 1.5rem;
      padding-top: 5rem;
    }

    .sidebar.active + .main-content {
      margin-left: 280px;
    }

    /* Sidebar Toggle Button */
    .sidebar-toggle {
      position: fixed;
      top: 1rem;
      left: 1rem;
      background: white;
      border: none;
      border-radius: 4px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: var(--transition);
    }

    .sidebar-toggle:hover {
      background: #f1f1f1;
    }

    .sidebar-toggle i {
      font-size: 1.25rem;
      color: var(--text-primary);
    }

    /* Responsive */
    @media (min-width: 1024px) {
      .sidebar {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 280px;
      }
      
      .sidebar-toggle {
        display: none;
      }
    }

    /* Report Card Container */
    .report-card-container {
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .report-card-preview {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .report-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .report-header h3 {
      color: #333;
      margin-bottom: 1rem;
    }

    .student-info {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .student-info p {
      margin: 0;
    }

    .marks-table {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
    }

    .marks-table table {
      width: 100%;
      border-collapse: collapse;
    }

    .marks-table th,
    .marks-table td {
      padding: 0.75rem;
      text-align: center;
      border-bottom: 1px solid #dee2e6;
    }

    .marks-table th {
      background-color: #f8f9fa;
      font-weight: 600;
    }

    .summary-section {
      background: #fff;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
    }

    .summary-section p {
      margin: 0.5rem 0;
    }

    .report-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .btn {
      padding: 0.5rem 1.5rem;
      border-radius: 4px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background-color: #007bff;
      color: white;
    }

    .btn-success {
      background-color: #28a745;
      color: white;
    }

    .btn-info {
      background-color: #17a2b8;
      color: white;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .form-section {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .form-control {
      padding: 0.5rem;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 1rem;
    }
  </style>
</head>

<body>
  <button class="sidebar-toggle" aria-label="Toggle sidebar">
    <i class="fas fa-bars"></i>
  </button>
  
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">
        <i class="fas fa-graduation-cap"></i>
      </div>
      <h2>SchoolSync</h2>
    </div>
    
    <div class="sidebar-profile">
      <div class="profile-avatar">
        <i class="fas fa-user"></i>
      </div>
      <div class="profile-info">
        <div class="profile-name">Teacher</div>
      </div>
    </div>
    
    <ul class="sidebar-menu">
      <li class="tab-link active" data-tab="profile-section">
        <i class="fas fa-user"></i>
        <span>Profile</span>
      </li>
      <li class="tab-link" data-tab="class-management-section">
        <i class="fas fa-chalkboard-teacher"></i>
        <span>Class Management</span>
      </li>
      <li class="tab-link" data-tab="homework-section">
        <i class="fas fa-book"></i>
        <span>Homework</span>
      </li>
      <li class="tab-link" data-tab="timetable-section">
        <i class="fas fa-calendar-alt"></i>
        <span>Timetable</span>
      </li>
      <li class="tab-link" data-tab="reportcard-section">
        <i class="fas fa-file-alt"></i>
        <span>Report Card</span>
      </li>
      <li class="tab-link" data-tab="attendance-section">
        <i class="fas fa-clipboard-check"></i>
        <span>Attendance</span>
      </li>
      <li class="tab-link" data-tab="announcements-section">
        <i class="fas fa-bullhorn"></i>
        <span>Announcements</span>
      </li>
      <li class="tab-link" data-tab="resources-section">
        <i class="fas fa-book-open"></i>
        <span>Resources</span>
      </li>
      <li class="tab-link" data-tab="quizzes-section" onclick="window.location.href='manage-quizzes.html'">
        <i class="fas fa-question-circle"></i>
        <span>Quizzes</span>
      </li>
      <li class="tab-link" data-tab="communication-section">
        <i class="fas fa-comments"></i>
        <span>Communication</span>
      </li>
      <li class="tab-link" data-tab="logout-section">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header>
      <h1>Welcome, Teacher</h1>
    </header>

    <!-- Profile Information Section -->
    <section id="profile-section" class="tab-section">
      <h2>Profile Information</h2>
      <div class="profile-card">
        <!-- Loading Indicator -->
        <div id="loading-indicator" style="display: none;">
          <p>Loading profile information...</p>
        </div>
        
        <!-- Error and Success Messages -->
        <div id="error-message" class="message" style="display: none;"></div>
        <div id="success-message" class="message" style="display: none;"></div>
        
        <!-- Profile Header -->
        <div class="profile-header">
          <div class="profile-photo-container">
            <img id="profile-photo" src="../images/default-avatar.png" alt="Profile Photo" class="profile-photo">
            <input type="file" id="photo-upload" accept="image/*">
            <button type="button" id="change-photo-btn" class="btn">Change Photo</button>
          </div>
        </div>

        <!-- Profile Information Form -->
        <div class="form-section">
          <h3>Personal Information</h3>
          <form id="profile-form">
            <div class="form-group">
              <label for="teacher-name">Full Name</label>
              <input type="text" id="teacher-name" required>
            </div>
            <div class="form-group">
              <label for="teacher-email">Email</label>
              <input type="email" id="teacher-email" required>
            </div>
            <div class="form-group">
              <label for="teacher-subjects">Subjects (comma-separated)</label>
              <input type="text" id="teacher-subjects" placeholder="e.g., Mathematics, Science" required>
            </div>
            <button type="submit" id="save-profile-btn" class="btn btn-primary">
              <span class="btn-text">Save Changes</span>
            </button>
          </form>
        </div>

        <!-- Change Password Form -->
        <div class="form-section">
          <h3>Change Password</h3>
          <form id="password-form">
            <div class="form-group">
              <label for="current-password">Current Password</label>
              <input type="password" id="current-password" required>
            </div>
            <div class="form-group">
              <label for="new-password">New Password</label>
              <input type="password" id="new-password" required minlength="6">
              <small class="form-text">Password must be at least 6 characters long</small>
            </div>
            <button type="submit" id="change-password-btn" class="btn btn-primary">
              <span class="btn-text">Change Password</span>
            </button>
          </form>
        </div>
      </div>
    </section>
    
    <!-- Add the profile CSS -->
    <link rel="stylesheet" href="../css/profile.css">
    
    <!-- Add the profile JS -->
    <script src="../js/profile.js"></script>

    <!-- Class Management Section -->
    <section id="class-management-section" class="tab-section">
      <div class="class-management-container">
        <!-- Class Selection Panel -->
        <div class="class-selection-panel">
          <div class="section-header">
            <h2>Class Management</h2>
          </div>
          
          <!-- Status Message -->
          <div id="class-message" class="alert" style="display: none; margin-bottom: 20px;"></div>
          
          <!-- Class Dropdown -->
          <div class="form-group">
            <label for="class-select">
              <i class="fas fa-chalkboard-teacher"></i> Select Class
            </label>
            <select id="class-select" class="form-control">
              <option value="">-- Select a class --</option>
              <optgroup label="Primary School">
                <option value="Grade 1">Grade 1</option>
                <option value="Grade 2">Grade 2</option>
                <option value="Grade 3">Grade 3</option>
                <option value="Grade 4">Grade 4</option>
                <option value="Grade 5">Grade 5</option>
                <option value="Grade 6">Grade 6</option>
                <option value="Grade 7">Grade 7</option>
                <option value="Grade 8">Grade 8</option>
              </optgroup>
              <optgroup label="Secondary School">
                <option value="Form 1">Form 1</option>
                <option value="Form 2">Form 2</option>
                <option value="Form 3">Form 3</option>
                <option value="Form 4">Form 4</option>
              </optgroup>
            </select>
          </div>
          
          <!-- Student List -->
          <div class="student-list-container">
            <h3>Students</h3>
            <div class="student-list" id="student-list">
              <div class="empty-state">Select a class to view students</div>
            </div>
          </div>
        </div>
        
        <!-- Student Profile Panel -->
        <div class="student-profile-panel">
          <div id="student-profile">
            <div class="empty-profile">
              <i class="fas fa-user-graduate"></i>
              <p>Select a student to view profile</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Class Modal -->
    <div id="class-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Add New Class</h3>
          <span class="close-btn">&times;</span>
        </div>
        <div class="modal-body">
          <form id="class-form">
            <input type="hidden" name="editMode" value="false">
            <input type="hidden" name="classId" value="">
            
            <div class="form-row">
              <div class="form-group">
                <label for="className">Class Name *</label>
                <input type="text" id="className" name="className" required>
              </div>
              
              <div class="form-group">
                <label for="level">Level</label>
                <select id="level" name="level">
                  <option value="">Select Level</option>
                  <option value="Pre-School">Pre-School</option>
                  <option value="Primary">Primary</option>
                  <option value="Elementary">Elementary</option>
                  <option value="Middle School">Middle School</option>
                  <option value="High School">High School</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="section">Section</label>
                <input type="text" id="section" name="section" placeholder="e.g., A, B, C">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="capacity">Capacity</label>
                <input type="number" id="capacity" name="capacity" min="1" value="30">
              </div>
              
              <div class="form-group">
                <label for="teacherInCharge">Teacher In Charge</label>
                <input type="text" id="teacherInCharge" name="teacherInCharge">
              </div>
              
              <div class="form-group">
                <label for="roomNumber">Room Number</label>
                <input type="text" id="roomNumber" name="roomNumber">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="academicYear">Academic Year</label>
                <input type="text" id="academicYear" name="academicYear" placeholder="e.g., 2024-2025">
              </div>
              
              <div class="form-group full-width">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" rows="3"></textarea>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="cancel-class-btn">Cancel</button>
              <button type="submit" class="btn btn-primary">Save Class</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <style>
      /* Resource Card Styles */
      .resource-class-section {
        margin-bottom: 2rem;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        overflow: hidden;
      }

      .resource-class-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        background: #f5f7fa;
        border-bottom: 1px solid #e1e4e8;
      }

      .resource-class-header h3 {
        margin: 0;
        color: #2c3e50;
        font-size: 1.2rem;
      }

      .resource-count {
        background: #e1e4e8;
        color: #2c3e50;
        padding: 0.2rem 0.6rem;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .resources-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        padding: 1.5rem;
      }

      .resource-card {
        display: flex;
        align-items: flex-start;
        padding: 1.25rem;
        background: #fff;
        border: 1px solid #e1e4e8;
        border-radius: 8px;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .resource-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }

      .resource-icon {
        font-size: 1.8rem;
        margin-right: 1rem;
        color: #4a6cf7;
        min-width: 2.5rem;
        text-align: center;
      }

      .resource-content {
        flex: 1;
        min-width: 0;
      }

      .resource-name {
        font-weight: 500;
        color: #2c3e50;
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .resource-name a {
        color: inherit;
        text-decoration: none;
      }

      .resource-name a:hover {
        color: #4a6cf7;
        text-decoration: underline;
      }

      .resource-type {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 0.5rem;
      }

      .resource-meta {
        font-size: 0.8rem;
        color: #6c757d;
      }

      .resource-actions {
        display: flex;
        gap: 0.5rem;
        margin-left: 0.5rem;
      }

      .download-btn,
      .delete-btn {
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 4px;
        transition: color 0.2s, background-color 0.2s;
      }

      .download-btn:hover {
        color: #4a6cf7;
        background-color: rgba(74, 108, 247, 0.1);
      }

      .delete-btn:hover {
        color: #dc3545;
        background-color: rgba(220, 53, 69, 0.1);
      }

      /* Filter Container */
      .filter-container {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }

      .filter-container label {
        margin: 0;
        font-weight: 500;
        color: #495057;
      }

      /* Form Styles */
      .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }
      
      .form-group {
        flex: 1;
        min-width: 200px;
        margin-bottom: 1rem;
      }
      
      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
      }
      
      .form-group input[type="text"],
      .form-group input[type="number"],
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
      }
      
      .form-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
      }
      
      .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.2s;
      }
      
      .btn-primary {
        background-color: #4CAF50;
        color: white;
      }
      
      .btn-primary:hover {
        background-color: #45a049;
      }
      
      .marks-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }
      
      .mark-item {
        background: #f9f9f9;
        padding: 1rem;
        border-radius: 4px;
        border-left: 4px solid #4CAF50;
      }
      
      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        overflow-y: auto;
      }
      
      .modal-content {
        background-color: #fff;
        margin: 5% auto;
        padding: 2rem;
        border-radius: 8px;
        width: 90%;
        max-width: 900px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        position: relative;
      }
      
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #eee;
      }
      
      .close-modal {
        font-size: 1.8rem;
        font-weight: bold;
        cursor: pointer;
        color: #666;
        line-height: 1;
      }
      
      .close-modal:hover {
        color: #000;
      }
      
      .modal-body {
        padding: 1rem 0;
      }
      
      /* Button Styles */
      .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
      
      .btn-primary {
        background-color: #4CAF50;
        color: white;
      }
      
      .btn-primary:hover {
        background-color: #45a049;
      }
      
      .btn-secondary {
        background-color: #2196F3;
        color: white;
      }
      
      .btn-secondary:hover {
        background-color: #0b7dda;
      }
      
      .btn-danger {
        background-color: #f44336;
        color: white;
      }
      
      .btn-danger:hover {
        background-color: #d32f2f;
      }
      
      .btn:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }
      
      /* Report Card Styles */
      #report-card {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        max-width: 900px;
        margin: 0 auto;
      }
      
      .report-header {
        text-align: center;
        margin-bottom: 2rem;
      }
      
      .report-header h2 {
        margin: 0;
        color: #333;
      }
      
      .report-header p {
        margin: 0.5rem 0;
        color: #666;
      }
      
      .student-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #eee;
      }
      
      .marks-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1.5rem;
      }
      
      .marks-table th,
      .marks-table td {
        border: 1px solid #ddd;
        padding: 0.75rem;
        text-align: left;
      }
      
      .marks-table th {
        background-color: #f5f5f5;
      }
      
      .signature-line {
        margin-top: 3rem;
        display: flex;
        justify-content: space-between;
      }
      
      .signature {
        text-align: center;
        width: 200px;
      }
      
      .signature-line hr {
        width: 100%;
        margin: 0.5rem 0;
        border: 0;
        border-top: 1px solid #000;
      }
      
      /* Class Management Styles */
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      
      .table-responsive {
        overflow-x: auto;
        margin-bottom: 20px;
      }
      
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .data-table th,
      .data-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .data-table th {
        background-color: #f5f5f5;
        font-weight: 600;
      }
      
      .data-table tr:hover {
        background-color: #f9f9f9;
      }
      
      .btn-action {
        padding: 5px 10px;
        margin: 0 2px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s ease;
      }
      
      .btn-edit-class {
        background-color: #4CAF50;
        color: white;
      }
      
      .btn-edit-class:hover {
        background-color: #45a049;
      }
      
      .btn-delete-class {
        background-color: #f44336;
        color: white;
      }
      
      .btn-delete-class:hover {
        background-color: #d32f2f;
      }
      
      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        overflow: auto;
      }
      
      .modal-content {
        background-color: #fff;
        margin: 5% auto;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        max-width: 700px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
      }
      
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .close-btn {
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        color: #666;
      }
      
      .close-btn:hover {
        color: #000;
      }
      
      .form-row {
        display: flex;
        flex-wrap: wrap;
        margin: 0 -10px 15px;
      }
      
      .form-group {
        flex: 1;
        min-width: 200px;
        margin: 0 10px 15px;
      }
      
      .form-group.full-width {
        flex: 0 0 calc(100% - 20px);
      }
      
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }
      
      .form-group input[type="text"],
      .form-group input[type="number"],
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      
      .form-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
      }
      
      .form-actions button {
        margin-left: 10px;
      }
      
      /* Alert Messages */
      .alert {
        padding: 12px 20px;
        border-radius: 4px;
        margin-bottom: 20px;
      }
      
      .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      
      .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      
      .alert-info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
    </style>

    <!-- Homework Section -->
    <section id="homework-section" class="tab-section">
      <h2>Homework</h2>
      <div class="form-section">
        <h4>Create New Homework</h4>
        <form id="create-homework-form" enctype="multipart/form-data">
          <div class="form-group">
            <label for="homework-title">Title:</label>
            <input type="text" id="homework-title" name="title" required />
          </div>
          <div class="form-group">
            <label for="homework-description">Description:</label>
            <textarea id="homework-description" name="description" required></textarea>
          </div>
          <div class="form-group">
            <label for="homework-due-date">Due Date:</label>
            <input type="date" id="homework-due-date" name="dueDate" required />
          </div>
          <div class="form-group">
            <label for="homework-class">Class Assigned:</label>
            <select id="homework-class" name="classAssigned" class="form-control" required>
              <option value="">Select Class</option>
              <optgroup label="Primary School">
                <option value="Grade 1">Grade 1</option>
                <option value="Grade 2">Grade 2</option>
                <option value="Grade 3">Grade 3</option>
                <option value="Grade 4">Grade 4</option>
                <option value="Grade 5">Grade 5</option>
                <option value="Grade 6">Grade 6</option>
                <option value="Grade 7">Grade 7</option>
                <option value="Grade 8">Grade 8</option>
              </optgroup>
              <optgroup label="Secondary School">
                <option value="Form 1">Form 1</option>
                <option value="Form 2">Form 2</option>
                <option value="Form 3">Form 3</option>
                <option value="Form 4">Form 4</option>
              </optgroup>
            </select>
          </div>
          <div class="form-group">
            <label for="homework-file">Upload File (PDF/DOCX):</label>
            <input type="file" id="homework-file" name="homework-file" accept=".pdf,.doc,.docx" />
          </div>
          <button type="submit" class="modern-btn">Create Homework</button>
          <div id="homework-create-msg" style="display:none;margin-top:8px;"></div>
        </form>
      </div>
      <div class="form-section">
        <div class="homework-header">
          <h4>All Homeworks</h4>
          <div class="filter-container">
            <label for="class-filter">Filter by Class:</label>
            <select id="class-filter">
              <option value="all">All Classes</option>
              <!-- Class options will be populated by JavaScript -->
            </select>
          </div>
        </div>
        <ul id="homework-list"></ul>
      </div>
      <style>
        .homework-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 15px;
        }
        .filter-container {
          display: flex;
          align-items: center;
          gap: 10px;
        }
        #class-filter {
          padding: 5px 10px;
          border-radius: 4px;
          border: 1px solid #ccc;
        }
      </style>
    </section>

    <!-- Timetable Section -->
    <section id="timetable-section" class="tab-section">
      <div class="section-header">
        <h2>Weekly Timetable</h2>
        <button id="create-timetable-btn" class="btn btn-primary">
          <i class="fas fa-plus"></i> Create Timetable
        </button>
      </div>
      
      <div class="timetable-controls">
        <button id="prev-week" class="btn"><i class="fas fa-chevron-left"></i> Previous Week</button>
        <h3 id="current-week">Week of June 24, 2024</h3>
        <button id="next-week" class="btn">Next Week <i class="fas fa-chevron-right"></i></button>
      </div>
      
      <div class="timetable-container">
        <div class="timetable-header">
          <div class="time-slot">Time</div>
          <div class="day">Monday</div>
          <div class="day">Tuesday</div>
          <div class="day">Wednesday</div>
          <div class="day">Thursday</div>
          <div class="day">Friday</div>
        </div>
        
        <div class="timetable-body">
          <!-- Time slots will be generated by JavaScript -->
        </div>
      </div>
      
      <style>
        .timetable-controls {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin: 20px 0;
          padding: 10px;
          background: #f5f7fa;
          border-radius: 8px;
        }
        
        .timetable-container {
          width: 100%;
          border: 1px solid #e0e0e0;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .timetable-header {
          display: grid;
          grid-template-columns: 100px repeat(5, 1fr);
          background: #4a6da7;
          color: white;
          font-weight: bold;
        }
        
        .time-slot, .day {
          padding: 12px;
          text-align: center;
          border-right: 1px solid rgba(255,255,255,0.1);
        }
        
        .day:last-child {
          border-right: none;
        }
        
        .timetable-body {
          display: flex;
          flex-direction: column;
        }
        
        .time-row {
          display: grid;
          grid-template-columns: 100px repeat(5, 1fr);
          min-height: 80px;
        }
        
        .time-cell {
          padding: 8px;
          border-bottom: 1px solid #f0f0f0;
          border-right: 1px solid #f0f0f0;
          display: flex;
          flex-direction: column;
          justify-content: flex-start;
          align-items: stretch;
          position: relative;
          align-items: center;
          justify-content: center;
          background: #fff;
        }
        
        .time-cell.time-label {
          font-weight: bold;
          background: #f9f9f9;
        }
        
        .class-slot {
          background-color: #e3f2fd;
          border-radius: 4px;
          padding: 8px 24px 8px 8px;
          margin: 4px 0;
          cursor: pointer;
          border-left: 4px solid #1976d2;
          text-align: left;
          font-size: 12px;
          white-space: normal;
          word-wrap: break-word;
          transition: all 0.2s ease;
          display: block;
          width: 100%;
          box-sizing: border-box;
          color: #333;
          box-shadow: 0 1px 2px rgba(0,0,0,0.1);
          position: relative;
        }
        
        .delete-btn {
          position: absolute;
          top: 2px;
          right: 2px;
          background: rgba(0,0,0,0.1);
          border: none;
          border-radius: 50%;
          width: 16px;
          height: 16px;
          font-size: 10px;
          line-height: 1;
          padding: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          color: #666;
        }
        
        .delete-btn:hover {
          background: #f44336;
          color: white;
        }
        
        .class-slot:hover {
          background-color: #bbdefb;
          transform: translateX(2px);
          box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        
        /* Different colors for different subjects */
        .class-eng { background-color: #e3f2fd; border-left-color: #1976d2; }
        .class-math { background-color: #e8f5e9; border-left-color: #388e3c; }
        .class-sci { background-color: #fff3e0; border-left-color: #f57c00; }
        .class-sst { background-color: #f3e5f5; border-left-color: #8e24aa; }
        .class-kis { background-color: #e0f7fa; border-left-color: #00acc1; }
        .class-cre { background-color: #fce4ec; border-left-color: #c2185b; }
        
        /* Simple Modal */
        #create-timetable-modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.7);
          z-index: 1000;
          justify-content: center;
          align-items: center;
        }
        
        #create-timetable-modal.show {
          display: flex;
        }
        
        #create-timetable-modal .modal-content {
          background: white;
          padding: 30px;
          border-radius: 8px;
          width: 90%;
          max-width: 500px;
          position: relative;
        }
        
        #create-timetable-modal .close-btn {
          position: absolute;
          top: 10px;
          right: 15px;
          font-size: 24px;
          background: none;
          border: none;
          cursor: pointer;
        }
        
        /* Test Modal */
        #test-modal {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 80%;
          max-width: 500px;
          background: white;
          padding: 20px;
          border-radius: 8px;
          z-index: 10000;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          display: none; /* Hidden by default */
        }
        
        #test-modal.active {
          display: block;
        }
        
        #create-timetable-modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
          z-index: 1000;
          padding: 20px;
          box-sizing: border-box;
        }
        
        #create-timetable-modal.active {
          display: flex;
          justify-content: center;
          align-items: center;
        }
        
        .modal-content {
          position: relative;
          background: white;
          padding: 25px;
          border-radius: 8px;
          width: 100%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          margin: auto;
          z-index: 10000;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 15px;
          border-bottom: 1px solid #eee;
        }
        
        .modal-header h3 {
          margin: 0;
          color: #2c3e50;
        }
        
        .close-modal {
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #7f8c8d;
        }
        
        .form-group {
          margin-bottom: 15px;
        }
        
        .form-group label {
          display: block;
          margin-bottom: 5px;
          font-weight: 500;
          color: #2c3e50;
        }
        
        .form-control {
          width: 100%;
          padding: 8px 12px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 14px;
        
        .btn-submit {
          background-color: #4a6da7;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          margin-top: 10px;
        }
        
        .btn-submit:hover {
          background-color: #3a5a8c;
        }
        
        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
        }
        
        .btn-primary {
          background-color: #4a6da7;
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 4px;
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 8px;
        }
        
        .btn-primary:hover {
          background-color: #3a5a8c;
        }
      </style>
      
      <!-- Create Timetable Modal -->
      <div id="create-timetable-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto; padding: 20px; box-sizing: border-box;">
        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%; position: relative; margin: 40px auto; max-height: calc(100vh - 80px); overflow-y: auto;">
          <button id="close-timetable-modal" style="position: absolute; top: 10px; right: 15px; font-size: 24px; background: none; border: none; cursor: pointer;">&times;</button>
          <h3>Create New Timetable Entry</h3>
          <form id="timetable-entry-form">
            <div class="form-group">
              <label for="timetable-class">Class</label>
              <select id="timetable-class" class="form-control" required>
                <option value="">Select Class</option>
                <optgroup label="Primary School">
                  <option value="grade-1">Grade 1</option>
                  <option value="grade-2">Grade 2</option>
                  <option value="grade-3">Grade 3</option>
                  <option value="grade-4">Grade 4</option>
                  <option value="grade-5">Grade 5</option>
                  <option value="grade-6">Grade 6</option>
                  <option value="grade-7">Grade 7</option>
                  <option value="grade-8">Grade 8</option>
                </optgroup>
                <optgroup label="Secondary School">
                  <option value="form-1">Form 1</option>
                  <option value="form-2">Form 2</option>
                  <option value="form-3">Form 3</option>
                  <option value="form-4">Form 4</option>
                </optgroup>
              </select>
            </div>
            
            <div class="form-group">
              <label for="timetable-subject">Subject</label>
              <input type="text" id="timetable-subject" class="form-control" placeholder="e.g., Mathematics, English" required>
            </div>
            
            <div class="form-group">
              <label for="timetable-day">Day</label>
              <select id="timetable-day" class="form-control" required>
                <option value="">Select Day</option>
                <option value="monday">Monday</option>
                <option value="tuesday">Tuesday</option>
                <option value="wednesday">Wednesday</option>
                <option value="thursday">Thursday</option>
                <option value="friday">Friday</option>
              </select>
            </div>
            
            <div class="form-group time-input-group">
              <label for="timetable-start-time">Start Time</label>
              <div style="position: relative; display: flex; align-items: center;">
                <input type="time" id="timetable-start-time" class="form-control" required style="padding-right: 30px;">
                <button type="button" class="clear-time-btn" data-target="timetable-start-time" style="position: absolute; right: 8px; background: none; border: none; color: #999; cursor: pointer; font-size: 16px; line-height: 1; padding: 4px;">×</button>
              </div>
            </div>
            
            <div class="form-group time-input-group">
              <label for="timetable-end-time">End Time</label>
              <div style="position: relative; display: flex; align-items: center;">
                <input type="time" id="timetable-end-time" class="form-control" required style="padding-right: 30px;">
                <button type="button" class="clear-time-btn" data-target="timetable-end-time" style="position: absolute; right: 8px; background: none; border: none; color: #999; cursor: pointer; font-size: 16px; line-height: 1; padding: 4px;">×</button>
              </div>
            </div>
            
            <div class="form-group">
              <label for="timetable-room">Room (Optional)</label>
              <input type="text" id="timetable-room" class="form-control" placeholder="e.g., Room 101">
            </div>
            
            <button type="submit" class="btn-submit">
              <i class="fas fa-save"></i> Save Entry
            </button>
          </form>
        </div>
      </div>
      
     
      <script>
      // JavaScript for the teacher dashboard
      document.addEventListener('DOMContentLoaded', function() {
        // API base URL - update this to your actual API endpoint
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // Get teacher ID from JWT token or user session
        function getTeacherId() {
          // This is a placeholder - replace with actual JWT token parsing
          const token = localStorage.getItem('token');
          if (!token) {
            console.error('No authentication token found');
            return null;
          }
          try {
            // In a real app, you would decode the JWT token to get the user ID
            // This is a simplified example
            const payload = JSON.parse(atob(token.split('.')[1]));
            return payload.userId || null;
          } catch (error) {
            console.error('Error parsing token:', error);
            return null;
          }
        }
        
        // Fetch classes for the logged-in teacher
        async function fetchTeacherClasses() {
          const teacherId = getTeacherId();
          if (!teacherId) {
            showError('Please log in to view your classes');
            return [];
          }
          
          try {
            const response = await fetch(`${API_BASE_URL}/teachers/${teacherId}/classes`, {
              headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
                'Content-Type': 'application/json'
              }
            });
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            return data.classes || [];
          } catch (error) {
            console.error('Error fetching classes:', error);
            showError('Failed to load classes. Please try again later.');
            return [];
          }
        }
        
        // Load students for selected class
        async function loadStudentsForClass(className) {
          try {
            console.log('Loading students for class:', className);
            
            // Get token from localStorage
            const token = localStorage.getItem('token');
            if (!token) {
              console.error('No authentication token found');
              throw new Error('Authentication token not found');
            }

            // Make API request
            const response = await fetch(`http://localhost:5000/api/students/class/${className}`, {
              method: 'GET',
              headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
              }
            });

            if (!response.ok) {
              const errorText = await response.text();
              console.error('API error response:', errorText);
              throw new Error(`Failed to load students: ${response.status} ${response.statusText}`);
            }

            // Parse and validate response
            const students = await response.json();
            console.log('Raw response:', students);
            
            if (!Array.isArray(students)) {
              console.error('Invalid response format:', typeof students);
              throw new Error('Invalid response format - expected array of students');
            }

            // Log the students data
            console.log('Loaded students:', students);
            return students;
          } catch (error) {
            console.error('Error loading students:', error);
            throw error;
          }
        }
        
        // Fetch students for a specific class
        async function fetchClassStudents(className) {
          if (!className) return [];
          
          try {
            // First, get all users with role 'student'
            const response = await fetch(`${API_BASE_URL}/users?role=student`, {
              headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
                'Content-Type': 'application/json'
              }
            });
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            // Filter students by class
            return Array.isArray(data) 
              ? data.filter(student => 
                  student.profile && 
                  student.profile.class && 
                  student.profile.class.toLowerCase() === className.toLowerCase()
                )
              : [];
          } catch (error) {
            console.error('Error fetching students:', error);
            showError('Failed to load students. Please try again later.');
            return [];
          }
        }
        
        // Fetch detailed student profile
        async function fetchStudentProfile(studentId) {
          if (!studentId) return null;
          
          try {
            const response = await fetch(`${API_BASE_URL}/students/${studentId}`, {
              headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
                'Content-Type': 'application/json'
              }
            });
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            return await response.json();
          } catch (error) {
            console.error('Error fetching student profile:', error);
            showError('Failed to load student profile. Please try again later.');
            return null;
          }
        }
        
        // Show error message
        function showError(message) {
          const errorDiv = document.getElementById('class-message');
          if (errorDiv) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            errorDiv.className = 'alert alert-error';
            
            // Hide after 5 seconds
            setTimeout(() => {
              errorDiv.style.display = 'none';
            }, 5000);
          }
        }
        
        // Show success message
        function showSuccess(message) {
          const successDiv = document.getElementById('class-message');
          if (successDiv) {
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            successDiv.className = 'alert alert-success';
            
            // Hide after 5 seconds
            setTimeout(() => {
              successDiv.style.display = 'none';
            }, 5000);
          }
        }

        // DOM Elements
        const classList = document.getElementById('class-list');
        const studentList = document.getElementById('student-list');
        const studentProfile = document.getElementById('student-profile');
        
        // Initialize the class list
        async function initializeClassList() {
          classList.innerHTML = '<div class="empty-state">Loading classes...</div>';
          
          try {
            const classes = await fetchTeacherClasses();
            
            if (classes.length === 0) {
              classList.innerHTML = '<div class="empty-state">No classes found</div>';
              return;
            }
            
            classList.innerHTML = ''; // Clear loading message
            
            for (const cls of classes) {
              const classItem = document.createElement('div');
              classItem.className = 'class-item';
              classItem.dataset.classId = cls._id || cls.id;
              
              // Get student count for this class
              const students = await fetchClassStudents(cls._id || cls.id);
              const studentCount = students.length;
              
              classItem.innerHTML = `
                <div class="class-name">${cls.name || 'Unnamed Class'}</div>
                <div class="class-details">
                  <span>${cls.level || 'N/A'} - Section ${cls.section || 'N/A'}</span>
                  <span>${studentCount} ${studentCount === 1 ? 'student' : 'students'}</span>
                </div>
              `;
              
              classItem.addEventListener('click', async () => {
                // Remove active class from all class items
                document.querySelectorAll('.class-item').forEach(item => {
                  item.classList.remove('active');
                });
                
                // Add active class to clicked item
                classItem.classList.add('active');
                
                // Show loading state
                studentList.innerHTML = '<div class="empty-state">Loading students...</div>';
                
                // Load students for this class
                await loadStudents(cls._id || cls.id);
                
                // Clear student profile
                studentProfile.innerHTML = `
                  <div class="empty-profile">
                    <i class="fas fa-user-graduate"></i>
                    <p>Select a student to view profile</p>
                  </div>
                `;
              });
              
              classList.appendChild(classItem);
            }
            
            // Select first class by default if available
            const firstClass = classList.firstElementChild;
            if (firstClass) {
              firstClass.click();
            }
          } catch (error) {
            console.error('Error initializing class list:', error);
            classList.innerHTML = '<div class="empty-state">Error loading classes</div>';
          }
        }
        
        // Load students for a class
        async function loadStudents(classId) {
          if (!classId) {
            studentList.innerHTML = '<div class="empty-state">No class selected</div>';
            return;
          }
          
          try {
            studentList.innerHTML = '<div class="empty-state">Loading students...</div>';
            
            const students = await fetchClassStudents(classId);
            
            if (students.length === 0) {
              studentList.innerHTML = '<div class="empty-state">No students found in this class</div>';
              return;
            }
            
            studentList.innerHTML = ''; // Clear loading message
            
            for (const student of students) {
              const studentItem = document.createElement('div');
              studentItem.className = 'student-item';
              studentItem.dataset.studentId = student._id || student.id;
              
              const firstName = student.firstName || 'Unknown';
              const lastName = student.lastName || '';
              const initials = (firstName[0] + (lastName ? lastName[0] : '')).toUpperCase();
              const studentId = student.studentId || 'N/A';
              
              studentItem.innerHTML = `
                <div class="student-avatar">${initials}</div>
                <div class="student-info">
                  <div class="student-name">${firstName} ${lastName}</div>
                  <div class="student-id">ID: ${studentId}</div>
                </div>
              `;
              
              studentItem.addEventListener('click', async () => {
                // Show loading state
                studentProfile.innerHTML = `
                  <div class="empty-profile">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading profile...</p>
                  </div>
                `;
                
                // Fetch and display full student profile
                const fullProfile = await fetchStudentProfile(student._id || student.id);
                if (fullProfile) {
                  displayStudentProfile(fullProfile);
                }
              });
              
              studentList.appendChild(studentItem);
            }
          } catch (error) {
            console.error('Error loading students:', error);
            studentList.innerHTML = '<div class="empty-state">Error loading students</div>';
          }
        }
        
        // Display student profile
        function displayStudentProfile(student) {
          if (!student) {
            studentProfile.innerHTML = `
              <div class="empty-profile">
                <i class="fas fa-exclamation-circle"></i>
                <p>Error loading student profile</p>
              </div>
            `;
            return;
          }
          
          // Extract student data with fallbacks
          const name = student.name || 'Unknown Student';
          const [firstName, ...lastNameParts] = name.split(' ');
          const lastName = lastNameParts.join(' ');
          const initials = (firstName[0] + (lastName ? lastName[0] : '')).toUpperCase();
          
          // Format dates
          const formatDate = (dateString) => {
            if (!dateString) return 'N/A';
            try {
              const date = new Date(dateString);
              return isNaN(date.getTime()) ? 'N/A' : date.toLocaleDateString();
            } catch (e) {
              console.error('Error formatting date:', e);
              return 'N/A';
            }
          };
          
          // Get class information from the selected class dropdown if available
          const classSelect = document.getElementById('class-select');
          const selectedClass = classSelect ? classSelect.options[classSelect.selectedIndex] : null;
          const className = selectedClass ? selectedClass.text : (student.className || 'N/A');
          const classLevel = selectedClass ? selectedClass.parentElement.label : (student.level || 'N/A');
          
          studentProfile.innerHTML = `
            <div class="profile-header">
              <div class="profile-avatar">${initials}</div>
              <div class="profile-details">
                <h3>${name}</h3>
                <p>Student ID: ${student.studentId || 'N/A'}</p>
                ${student.gender ? `<p>Gender: ${student.gender}</p>` : ''}
              </div>
            </div>
            
            <div class="profile-section">
              <h4>Personal Information</h4>
              <div class="info-grid">
                <div class="info-label">Date of Birth:</div>
                <div>${formatDate(student.dob || student.dateOfBirth)}</div>
                
                ${student.gender ? `
                <div class="info-label">Gender:</div>
                <div>${student.gender}</div>
                ` : ''}
                
                ${student.parentName ? `
                <div class="info-label">Parent/Guardian:</div>
                <div>${student.parentName}</div>
                ` : ''}
                
                ${student.parentContact ? `
                <div class="info-label">Parent Contact:</div>
                <div>${student.parentContact}</div>
                ` : ''}
                
                ${student.admissionDate ? `
                <div class="info-label">Admission Date:</div>
                <div>${formatDate(student.admissionDate)}</div>
                ` : ''}
              </div>
            </div>
            
            <div class="profile-section">
              <h4>Contact Information</h4>
              <div class="info-grid">
                <div class="info-label">Email:</div>
                <div>${student.email || 'N/A'}</div>
                
                <div class="info-label">Phone:</div>
                <div>${student.phone || student.parentContact || 'N/A'}</div>
                
                ${student.address ? `
                <div class="info-label">Address:</div>
                <div>${student.address}</div>
                ` : ''}
              </div>
            </div>
            
            <div class="profile-section">
              <h4>Class Information</h4>
              <div class="info-grid">
                <div class="info-label">Class:</div>
                <div>${className}</div>
                
                <div class="info-label">Level:</div>
                <div>${classLevel}</div>
                
                ${student.section ? `
                <div class="info-label">Section:</div>
                <div>${student.section}</div>
                ` : ''}
              </div>
            </div>
            
            ${student.additionalNotes ? `
            <div class="profile-section">
              <h4>Additional Notes</h4>
              <div class="additional-notes">
                ${student.additionalNotes}
              </div>
            </div>` : ''}
            
            <div class="profile-actions">
              <button class="btn btn-primary" id="message-student-btn">
                <i class="fas fa-envelope"></i> Send Message
              </button>
              <button class="btn" id="print-profile-btn">
                <i class="fas fa-print"></i> Print Profile
              </button>
            </div>
            
            <style>
              .additional-notes {
                background: #f8f9fa;
                padding: 12px;
                border-radius: 4px;
                border-left: 3px solid #4a6cf7;
                font-size: 0.95em;
                line-height: 1.5;
              }
              
              .info-grid {
                display: grid;
                grid-template-columns: 150px 1fr;
                gap: 10px 15px;
              }
              
              .info-label {
                color: #666;
                font-weight: 500;
              }
            </style>
          `;
          
          // Add event listeners to the action buttons
          const messageBtn = document.getElementById('message-student-btn');
          if (messageBtn) {
            messageBtn.addEventListener('click', () => {
              // Implement message functionality
              alert(`Message student: ${firstName} ${lastName} (${email || phone || 'No contact info'})`);
            });
          }
          
          const printBtn = document.getElementById('print-profile-btn');
          if (printBtn) {
            printBtn.addEventListener('click', () => {
              // Implement print functionality
              window.print();
            });
          }
        }
        
        // Get class select element
        const classSelect = document.getElementById('class-select');
        
        // Add event listener for class selection
        if (classSelect) {
          classSelect.addEventListener('change', async function() {
            const classId = this.value;
            if (!classId) {
              studentList.innerHTML = '<div class="empty-state">Select a class to view students</div>';
              return;
            }
            
            // Show loading state
            studentList.innerHTML = '<div class="empty-state">Loading students...</div>';
            
            try {
              // Fetch students for the selected class from the backend
              const students = await fetchClassStudents(classId);
              
              if (students.length === 0) {
                studentList.innerHTML = '<div class="empty-state">No students found in this class</div>';
                return;
              }
              
              // Transform student data to match the expected format
              const formattedStudents = students.map(student => ({
                id: student._id,
                name: student.name || 'Unknown Student',
                email: student.email || 'N/A',
                gender: student.profile?.gender || 'Not specified',
                dob: student.profile?.dob ? new Date(student.profile.dob).toLocaleDateString() : 'N/A',
                address: student.profile?.address || 'N/A',
                className: student.profile?.class || 'N/A',
                parentName: student.profile?.emergencyContact?.name || 'N/A',
                parentContact: student.profile?.emergencyContact?.phone || 'N/A',
                parentRelationship: student.profile?.emergencyContact?.relationship || 'N/A',
                allergies: student.profile?.health?.allergies?.join(', ') || 'None',
                medicalConditions: student.profile?.health?.medicalConditions?.join(', ') || 'None',
                medications: student.profile?.health?.medications?.join(', ') || 'None',
                // Include all other student properties
                ...student
              }));
              
              // Display students
              displayStudents(formattedStudents);
              
            } catch (error) {
              console.error('Error loading students:', error);
              showError('Failed to load students. Please try again.');
              studentList.innerHTML = '<div class="empty-state">Error loading students</div>';
            }
          });
        }
        
        // Function to display students in the list
        function displayStudents(students) {
          if (!students || students.length === 0) {
            studentList.innerHTML = '<div class="empty-state">No students found in this class</div>';
            return;
          }
          
          studentList.innerHTML = ''; // Clear previous content
          
          students.forEach(student => {
            const studentItem = document.createElement('div');
            studentItem.className = 'student-item';
            studentItem.dataset.studentId = student.id;
            
            studentItem.innerHTML = `
              <div class="student-avatar">${student.name.split(' ').map(n => n[0]).join('').toUpperCase()}</div>
              <div class="student-info">
                <div class="student-name">${student.name}</div>
                <div class="student-id">${student.studentId}</div>
              </div>
            `;
            
            // Add click event to show student profile
            studentItem.addEventListener('click', () => {
              // Remove active class from all student items
              document.querySelectorAll('.student-item').forEach(item => {
                item.classList.remove('active');
              });
              
              // Add active class to clicked item
              studentItem.classList.add('active');
              
              // Display student profile
              displayStudentProfile(student);
            });
            
            studentList.appendChild(studentItem);
          });
        }
        
        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', async function() {
          try {
            // Check if user is authenticated
            const token = localStorage.getItem('token');
            if (!token) {
              // Redirect to login if not authenticated
              window.location.href = '/login.html';
              return;
            }
            
            // Show loading state
            const classList = document.getElementById('class-list');
            if (classList) {
              classList.innerHTML = '<div class="empty-state">Loading your classes...</div>';
            }
            
            // Initialize the class list
            await initializeClassList();
            
            // Add event listener for the "Add New Class" button
            const addClassBtn = document.getElementById('add-class-btn');
            if (addClassBtn) {
              addClassBtn.addEventListener('click', function() {
                // This would open a modal or navigate to a new page in a real app
                const classModal = document.getElementById('class-modal');
                if (classModal) {
                  // Reset form
                  const form = classModal.querySelector('form');
                  if (form) form.reset();
                  
                  // Set modal title
                  const title = classModal.querySelector('.modal-title');
                  if (title) title.textContent = 'Add New Class';
                  
                  // Show modal
                  classModal.style.display = 'block';
                  document.body.style.overflow = 'hidden';
                }
              });
            }
            
            // Add event listener for closing the class modal
            const closeModalBtns = document.querySelectorAll('.close-btn, .modal .close');
            closeModalBtns.forEach(btn => {
              btn.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) {
                  modal.style.display = 'none';
                  document.body.style.overflow = '';
                }
              });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
              if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = '';
              }
            });
            
            // Handle class form submission
            const classForm = document.getElementById('class-form');
            if (classForm) {
              classForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const classData = {
                  name: formData.get('className'),
                  level: formData.get('level'),
                  section: formData.get('section'),
                  capacity: parseInt(formData.get('capacity') || '30'),
                  teacherInCharge: formData.get('teacherInCharge'),
                  roomNumber: formData.get('roomNumber'),
                  academicYear: formData.get('academicYear'),
                  notes: formData.get('notes')
                };
                
                try {
                  // Show loading state
                  const submitBtn = this.querySelector('button[type="submit"]');
                  const originalText = submitBtn.innerHTML;
                  submitBtn.disabled = true;
                  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                  
                  // In a real app, you would send this data to your API
                  console.log('Submitting class data:', classData);
                  
                  // Simulate API call
                  await new Promise(resolve => setTimeout(resolve, 1000));
                  
                  // Show success message
                  showSuccess('Class created successfully!');
                  
                  // Close modal
                  const modal = this.closest('.modal');
                  if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                  }
                  
                  // Refresh class list
                  await initializeClassList();
                  
                } catch (error) {
                  console.error('Error creating class:', error);
                  showError('Failed to create class. Please try again.');
                } finally {
                  if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                  }
                }
              });
            }
            
          } catch (error) {
            console.error('Error initializing application:', error);
            showError('Failed to initialize application. Please refresh the page.');
          }
        });
          const timetableBody = document.querySelector('.timetable-body');
          const currentWeekElement = document.getElementById('current-week');
          
          // Get current teacher ID from JWT token
          function getCurrentTeacherId() {
            try {
              // First try to get from userData in localStorage
              const userData = localStorage.getItem('userData');
              if (userData) {
                const parsedUserData = JSON.parse(userData);
                if (parsedUserData && parsedUserData.id) {
                  console.log('Got teacher ID from userData:', parsedUserData.id);
                  return parsedUserData.id;
                }
              }
              
              // Fallback to JWT token
              const token = localStorage.getItem('token');
              if (!token) {
                console.error('No JWT token found');
                window.location.href = '/login.html';
                return null;
              }
              
              // Decode JWT token
              const base64Url = token.split('.')[1];
              const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
              const payload = JSON.parse(atob(base64));
              
              // Try different possible ID fields
              const teacherId = payload.sub || payload.userId || payload.id || payload.user_id;
              
              if (!teacherId) {
                console.error('No user ID found in token or userData');
                console.log('Token payload:', payload);
                window.location.href = '/login.html';
                return null;
              }
              
              console.log('Got teacher ID from token:', teacherId);
              return teacherId.toString(); // Ensure it's a string
              
            } catch (error) {
              console.error('Error getting teacher ID:', error);
              window.location.href = '/login.html';
              return null;
            }
          }
          
          const currentTeacherId = getCurrentTeacherId();
          if (!currentTeacherId) {
            console.error('Failed to get teacher ID');
            // Handle error (e.g., redirect to login)
          }
          
          console.log('=== Initializing timetable for teacher:', currentTeacherId, '===');
          
          // Initialize empty arrays and objects
          let timetableData = {};
          let timetableEntries = [];
          
          // Try to load teacher-specific timetable data
          const teacherTimetableKey = `timetable_${currentTeacherId}`;
          console.log('Looking for timetable data with key:', teacherTimetableKey);
          
          // List all keys in localStorage for debugging
          console.log('All localStorage keys:', Object.keys(localStorage));
          
          const savedTimetableData = localStorage.getItem(teacherTimetableKey);
          
          if (savedTimetableData) {
            console.log('Found saved timetable data, parsing...');
            try {
              const parsedData = JSON.parse(savedTimetableData);
              console.log('Parsed timetable data:', parsedData);
              
              // Ensure we have the expected structure
              if (parsedData && typeof parsedData === 'object') {
                timetableData = parsedData.timetableData || {};
                timetableEntries = Array.isArray(parsedData.timetableEntries) ? 
                  parsedData.timetableEntries : [];
                
                console.log(`Loaded ${timetableEntries.length} entries for teacher ${currentTeacherId}`);
                
                // Log first few entries for verification
                if (timetableEntries.length > 0) {
                  console.log('Sample entries:', timetableEntries.slice(0, 2));
                }
              } else {
                console.warn('Unexpected data format in saved timetable');
              }
            } catch (e) {
              console.error('Error parsing saved timetable data:', e);
            }
          } else {
            console.log('No saved timetable data found for this teacher');
          }
          
          // Make sure we have arrays and filter out any entries not belonging to this teacher
          if (!Array.isArray(timetableEntries)) {
            console.warn('Invalid timetable entries, initializing empty array');
            timetableEntries = [];
          } else {
            // Double-check all entries belong to this teacher (sanity check)
            const initialCount = timetableEntries.length;
            timetableEntries = timetableEntries.filter(entry => {
              const isValid = entry && entry.teacherId === currentTeacherId;
              if (!isValid) {
                console.warn('Filtered out invalid/foreign entry:', entry);
              }
              return isValid;
            });
            
            if (timetableEntries.length !== initialCount) {
              console.warn(`Filtered out ${initialCount - timetableEntries.length} invalid/foreign entries`);
            }
          }
          
          // Rebuild timetableData based on filtered entries
          console.log('Rebuilding timetable data from', timetableEntries.length, 'entries');
          
          // First, clear any existing data
          timetableData = {};
          
          timetableEntries.forEach((entry, index) => {
            if (!entry || !entry.startTime || !entry.day) {
              console.warn('Skipping invalid entry at index', index, ':', entry);
              return;
            }
            
            console.log(`Processing entry ${index + 1}/${timetableEntries.length}:`, entry);
            
            // Ensure we have a slot for this start time
            if (!timetableData[entry.startTime]) {
              console.log(`Creating new time slot for ${entry.startTime}`);
              timetableData[entry.startTime] = {
                endTime: entry.endTime || '',
                monday: '',
                tuesday: '',
                wednesday: '',
                thursday: '',
                friday: ''
              };
            }
            
            const slot = timetableData[entry.startTime];
            const subject = entry.subject ? 
              (entry.subject.charAt(0).toUpperCase() + entry.subject.slice(1)) : 'Unknown';
            const className = entry.class ? 
              entry.class.replace(/-/g, ' ').replace(/\bgrade\b/gi, 'Grade').replace(/\bform\b/gi, 'Form') : 
              'Unknown';
              
            console.log(`Setting ${entry.day} at ${entry.startTime} to ${subject} (${className})`);
            slot[entry.day] = `${subject} (${className})`;
            
            if (entry.endTime) {
              slot.endTime = entry.endTime;
            }
          });
          
          console.log('Final timetable data structure:', timetableData);
          
          // Save data to localStorage
          function saveTimetableData() {
            try {
              // Save the complete state for this teacher
              const teacherTimetableKey = `timetable_${currentTeacherId}`;
              const dataToSave = {
                timetableData: timetableData,
                timetableEntries: timetableEntries,
                lastUpdated: new Date().toISOString()
              };
              
              localStorage.setItem(teacherTimetableKey, JSON.stringify(dataToSave));
              console.log('Saved teacher timetable data');
            } catch (error) {
              console.error('Error saving timetable data:', error);
            }
          }

          // Function to add a new time slot with start and end time
          function addTimeSlot(startTime, endTime) {
            if (!timetableData[startTime]) {
              timetableData[startTime] = {
                endTime: endTime || '',
                monday: '',
                tuesday: '',
                wednesday: '',
                thursday: '',
                friday: ''
              };
              saveTimetableData();
              return true;
            }
            return false;
          }
          
          // Add default breaks if they don't exist
          function initializeBreaks() {
            if (!timetableData['10:00']) {
              addTimeSlot('10:00', '10:30');
              const breakData = timetableData['10:00'];
              breakData.monday = breakData.tuesday = breakData.wednesday = breakData.thursday = breakData.friday = 'Break';
            }
            
            if (!timetableData['11:50']) {
              addTimeSlot('11:50', '12:30');
              const lunchData = timetableData['11:50'];
              lunchData.monday = lunchData.tuesday = lunchData.wednesday = lunchData.thursday = lunchData.friday = 'Lunch';
            }
            
            // Save after initializing breaks
            saveTimetableData();
          }
          
          // Initialize with breaks
          initializeBreaks();
          

          
          // Round time to nearest 30 minutes
          function roundToNearest30(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            const totalMinutes = hours * 60 + minutes;
            const roundedMinutes = Math.round(totalMinutes / 30) * 30;
            const roundedHours = Math.floor(roundedMinutes / 60);
            const finalMinutes = roundedMinutes % 60;
            return `${String(roundedHours).padStart(2, '0')}:${String(finalMinutes).padStart(2, '0')}`;
          }
          
          // Add a new entry to the timetable
          function addTimetableEntry(entry) {
            console.log('Adding timetable entry for teacher', currentTeacherId, ':', entry);
            
            // Add teacher ID and ensure entry has required fields
            const newEntry = {
              ...entry,
              id: entry.id || `entry-${Date.now()}`,
              teacherId: currentTeacherId,
              createdAt: new Date().toISOString()
            };
            
            // Add to entries array if it doesn't exist
            const exists = timetableEntries.some(e => 
              e.id === newEntry.id || 
              (e.day === newEntry.day && 
               e.startTime === newEntry.startTime &&
               e.teacherId === currentTeacherId)
            );
            
            if (!exists) {
              timetableEntries.push(newEntry);
              console.log('Added new entry:', newEntry);
              
              // Save to localStorage
              saveTimetableData();
              
              // Update the timetable data and UI
              updateTimetableData();
              generateTimetable();
            } else {
              console.log('Entry already exists, not adding duplicate');
            }
          }
          
          // Update timetable data from entries
          function updateTimetableData() {
            console.log('Updating timetable with entries:', timetableEntries);
            
            // Reset all slots except breaks and lunch
            Object.keys(timetableData).forEach(time => {
              if (time !== '10:00' && time !== '11:50') {
                const slot = timetableData[time];
                slot.monday = slot.tuesday = slot.wednesday = slot.thursday = slot.friday = '';
              }
            });
            
            // Add entries to the timetable
            timetableEntries.forEach(entry => {
              console.log('Processing entry:', entry);
              
              // Ensure the time slot exists
              if (!timetableData[entry.startTime]) {
                console.log('Creating new time slot for', entry.startTime);
                addTimeSlot(entry.startTime, entry.endTime || '');
              }
              
              const slot = timetableData[entry.startTime];
              if (slot) {
                const subject = entry.subject.charAt(0).toUpperCase() + entry.subject.slice(1);
                const className = entry.class.replace(/-/g, ' ').replace(/\bgrade\b/gi, 'Grade').replace(/\bform\b/gi, 'Form');
                const day = entry.day.toLowerCase();
                
                console.log(`Setting ${day} at ${entry.startTime} to ${subject} (${className})`);
                slot[day] = `${subject} (${className})`;
                
                // Ensure end time is set if provided
                if (entry.endTime) {
                  slot.endTime = entry.endTime;
                }
              }
            });
            
            console.log('Updated timetable data:', timetableData);
          }
          
          // Generate timetable with days as rows and time slots as columns
          function generateTimetable() {
            if (!timetableBody) {
              console.error('Timetable body element not found');
              return;
            }
            
            console.log('Generating timetable with data:', timetableData);
            
            // Clear existing content
            timetableBody.innerHTML = '';
            
            // Sort times to ensure correct order (convert to minutes for proper sorting)
            // and filter out specific time slots, then take first 13 columns
            const sortedTimes = Object.keys(timetableData)
              .filter(time => !['10:00', '11:50'].includes(time)) // Remove specific time slots
              .sort((a, b) => {
                const [aH, aM] = a.split(':').map(Number);
                const [bH, bM] = b.split(':').map(Number);
                return (aH * 60 + aM) - (bH * 60 + bM);
              })
              .slice(0, 12); // Take first 12 time slots (plus day column = 13 total columns)
            
            console.log('Sorted times:', sortedTimes);
            
            // Create table element
            const table = document.createElement('table');
            table.className = 'timetable';
            
            // Add delete handlers for columns and rows
            let isDeleteMode = false;
            
            function toggleDeleteMode() {
              isDeleteMode = !isDeleteMode;
              const deleteBtn = document.getElementById('toggleDeleteMode');
              if (deleteBtn) {
                deleteBtn.textContent = isDeleteMode ? 'Exit Delete Mode' : 'Delete Mode';
                deleteBtn.className = isDeleteMode ? 'btn btn-danger' : 'btn btn-secondary';
              }
              document.body.classList.toggle('delete-mode', isDeleteMode);
            }
            
            function deleteTimeSlot(time) {
              if (confirm(`Are you sure you want to delete the ${time} time slot? This will remove all classes at this time.`)) {
                delete timetableData[time];
                saveTimetableData();
                generateTimetable();
              }
            }
            
            function deleteDay(dayId) {
              const dayName = document.querySelector(`[data-day="${dayId}"]`).textContent;
              if (confirm(`Are you sure you want to clear all classes on ${dayName}?`)) {
                Object.keys(timetableData).forEach(time => {
                  if (timetableData[time][dayId]) {
                    delete timetableData[time][dayId];
                  }
                });
                saveTimetableData();
                generateTimetable();
              }
            }
            
            // Add delete mode toggle button
            const controlsRow = document.createElement('div');
            controlsRow.className = 'mb-3';
            const deleteBtn = document.createElement('button');
            deleteBtn.id = 'toggleDeleteMode';
            deleteBtn.className = 'btn btn-secondary';
            deleteBtn.textContent = 'Delete Mode';
            deleteBtn.onclick = toggleDeleteMode;
            controlsRow.appendChild(deleteBtn);
            timetableBody.parentNode.insertBefore(controlsRow, timetableBody);
            
            // Create header row with time slots as columns
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th>Day/Time</th>';
            
            // Add time slot headers
            sortedTimes.forEach(time => {
              const slot = timetableData[time];
              const timeHeader = document.createElement('th');
              timeHeader.textContent = `${time}${slot.endTime ? ' - ' + slot.endTime : ''}`;
              timeHeader.className = 'time-header';
              timeHeader.onclick = (e) => {
                if (isDeleteMode && !e.target.classList.contains('delete-column')) {
                  deleteTimeSlot(time);
                }
              };
              
              if (isDeleteMode) {
                const deleteBtn = document.createElement('span');
                deleteBtn.className = 'delete-column';
                deleteBtn.innerHTML = ' ×';
                deleteBtn.title = 'Delete this time slot';
                timeHeader.appendChild(deleteBtn);
              }
              headerRow.appendChild(timeHeader);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create table body
            const tbody = document.createElement('tbody');
            
            // Create rows for each day
            const days = [
              { id: 'monday', name: 'Monday' },
              { id: 'tuesday', name: 'Tuesday' },
              { id: 'wednesday', name: 'Wednesday' },
              { id: 'thursday', name: 'Thursday' },
              { id: 'friday', name: 'Friday' }
            ];
            
            days.forEach(day => {
              const row = document.createElement('tr');
              
              // Add day cell
              const dayCell = document.createElement('td');
              dayCell.className = 'day-cell';
              dayCell.setAttribute('data-day', day.id);
              dayCell.textContent = day.name;
              dayCell.onclick = (e) => {
                if (isDeleteMode && !e.target.classList.contains('delete-row')) {
                  deleteDay(day.id);
                }
              };
              
              if (isDeleteMode) {
                const deleteBtn = document.createElement('span');
                deleteBtn.className = 'delete-row';
                deleteBtn.innerHTML = ' ×';
                deleteBtn.title = 'Clear this day';
                dayCell.appendChild(deleteBtn);
              }
              row.appendChild(dayCell);
              
              // Add class cells for each time slot
              sortedTimes.forEach(time => {
                const slot = timetableData[time];
                const classCell = document.createElement('td');
                classCell.className = 'class-cell';
                
                const cls = slot[day.id] || '';
                
                if (cls) {
                  const classSlot = document.createElement('div');
                  const subject = cls.split(' ')[0].toLowerCase();
                  const className = cls.substring(0, cls.indexOf('(')).trim();
                  
                  classSlot.className = `class-slot class-${subject}`;
                  classSlot.title = `Click to view details for ${cls}`;
                  
                  // Add delete button
                  const deleteBtn = document.createElement('button');
                  deleteBtn.className = 'delete-btn';
                  deleteBtn.innerHTML = '&times;';
                  deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    if (confirm(`Are you sure you want to remove ${cls}?`)) {
                      delete timetableData[time][day.id];
                      
                      // Find and remove the entry
                      const entryIndex = timetableEntries.findIndex(entry => 
                        entry.day === day.id && 
                        entry.startTime === time &&
                        entry.subject.toLowerCase() === className.toLowerCase()
                      );
                      
                      if (entryIndex > -1) {
                        timetableEntries.splice(entryIndex, 1);
                        saveTimetableData();
                        updateTimetableData();
                        generateTimetable();
                      }
                    }
                  };
                  
                  classSlot.textContent = className;
                  classSlot.appendChild(deleteBtn);
                  
                  classSlot.onclick = () => {
                    alert(`Class: ${className}\nTime: ${time}${slot.endTime ? ' - ' + slot.endTime : ''}\nDay: ${day.name}`);
                  };
                  
                  classCell.appendChild(classSlot);
                }
                
                // Add click handler to add new entries
                classCell.onclick = (e) => {
                  if (e.target === classCell) {
                    document.getElementById('timetable-day').value = day.id;
                    document.getElementById('timetable-start-time').value = time;
                    if (slot.endTime) {
                      document.getElementById('timetable-end-time').value = slot.endTime;
                    }
                    document.getElementById('create-timetable-modal').style.display = 'block';
                    document.getElementById('timetable-subject').focus();
                  }
                };
                
                row.appendChild(classCell);
              });
              
              tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            timetableBody.appendChild(table);
            
            // Add styles if they don't exist
            if (!document.getElementById('timetable-styles')) {
              const style = document.createElement('style');
              style.id = 'timetable-styles';
              style.textContent = `
                .timetable {
                  width: 100%;
                  table-layout: fixed;
                  border-collapse: collapse;
                  margin: 20px 0;
                  font-size: 0.8em;
                  background: white;
                  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                }
                .timetable th, .timetable td {
                  border: 1px solid #e0e0e0;
                  padding: 6px 4px;
                  text-align: center;
                  overflow: hidden;
                  text-overflow: ellipsis;
                }
                .timetable th {
                  background-color: #f8f9fa;
                  font-weight: bold;
                  white-space: nowrap;
                  font-size: 0.85em;
                }
                .timetable th:first-child {
                  width: 120px; /* Slightly wider for delete button */
                }
                .delete-mode .time-header,
                .delete-mode .day-cell {
                  position: relative;
                  cursor: pointer;
                }
                .delete-mode .time-header:hover,
                .delete-mode .day-cell:hover {
                  background-color: #ffebee;
                }
                .delete-column,
                .delete-row {
                  color: #dc3545;
                  font-weight: bold;
                  cursor: pointer;
                  margin-left: 5px;
                  font-size: 1.2em;
                  line-height: 1;
                  display: inline-block;
                  vertical-align: middle;
                }
                .delete-column:hover,
                .delete-row:hover {
                  color: #b02a37;
                }
                .day-cell {
                  background-color: #f8f9fa;
                  font-weight: bold;
                  white-space: nowrap;
                }
                .class-cell {
                  min-width: 150px;
                  height: 80px;
                  vertical-align: top;
                  cursor: pointer;
                  transition: background-color 0.2s;
                }
                .class-cell:hover {
                  background-color: #f8f9fa;
                }
                .class-slot {
                  background-color: #e3f2fd;
                  border-left: 4px solid #1976d2;
                  padding: 8px;
                  margin: 2px 0;
                  border-radius: 4px;
                  cursor: pointer;
                  transition: all 0.2s;
                  position: relative;
                  height: 100%;
                  box-sizing: border-box;
                  display: flex;
                  flex-direction: column;
                  justify-content: center;
                  align-items: center;
                  text-align: center;
                }
                .class-slot:hover {
                  transform: translateY(-2px);
                  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                }

                .delete-btn {
                  position: absolute;
                  top: 2px;
                  right: 2px;
                  background: rgba(0,0,0,0.1);
                  border: none;
                  border-radius: 50%;
                  width: 18px;
                  height: 18px;
                  line-height: 16px;
                  text-align: center;
                  padding: 0;
                  cursor: pointer;
                  opacity: 0;
                  transition: opacity 0.2s;
                }
                .class-slot:hover .delete-btn {
                  opacity: 1;
                }
                .delete-btn:hover {
                  background: rgba(0,0,0,0.2);
                }
              `;
              document.head.appendChild(style);
            }
          }
          
          function getDayName(index) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            return days[index];
          }
          
          // Initialize timetable with any existing entries
          updateTimetableData();
          generateTimetable();
          
          // Add event listeners for clear time buttons
          document.querySelectorAll('.clear-time-btn').forEach(btn => {
            btn.addEventListener('click', function() {
              const targetId = this.getAttribute('data-target');
              const input = document.getElementById(targetId);
              if (input) {
                input.value = '';
                input.dispatchEvent(new Event('input')); // Trigger any input event listeners
              }
            });
          });
          
          // Log the current state for debugging
          console.log('Initial timetable data:', timetableData);
          console.log('Initial entries:', timetableEntries);
          
          // Add a button to add new time slots
          const addTimeSlotBtn = document.createElement('button');
          addTimeSlotBtn.textContent = 'Add Time Slot';
          addTimeSlotBtn.className = 'btn btn-secondary';
          addTimeSlotBtn.style.marginLeft = '10px';
          addTimeSlotBtn.onclick = function() {
            const timeInput = prompt('Enter time slot (e.g., 09:00 or 09:00-09:35):\nFor a range, use format: 09:00-09:35');
            if (timeInput) {
              const timeParts = timeInput.split('-').map(part => part.trim());
              const startTime = timeParts[0];
              const endTime = timeParts[1] || '';
              
              // Validate start time
              if (!/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(startTime)) {
                alert('Please enter a valid start time in HH:MM format (e.g., 09:00)');
                return;
              }
              
              // Validate end time if provided
              if (endTime && !/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(endTime)) {
                alert('Please enter a valid end time in HH:MM format (e.g., 09:35)');
                return;
              }
              
              if (addTimeSlot(startTime, endTime)) {
                generateTimetable();
              } else {
                alert('This time slot already exists');
              }
            }
          };
          
          // Add the button next to Create Timetable button
          const createBtn = document.getElementById('create-timetable-btn');
          if (createBtn && createBtn.parentNode) {
            createBtn.parentNode.insertBefore(addTimeSlotBtn, createBtn.nextSibling);
          }
          
          // Navigation between weeks
          document.getElementById('prev-week').addEventListener('click', () => {
            // In a real app, this would load the previous week's data
            alert('Loading previous week...');
          });
          
          document.getElementById('next-week').addEventListener('click', () => {
            // In a real app, this would load the next week's data
            alert('Loading next week...');
          });
          
          // Timetable Modal Functionality
          const timetableModal = document.getElementById('create-timetable-modal');
          const closeTimetableModal = document.getElementById('close-timetable-modal');
          const createTimetableBtn = document.getElementById('create-timetable-btn');
          const timetableForm = document.getElementById('timetable-entry-form');
          
          // Open modal
          if (createTimetableBtn && timetableModal) {
            createTimetableBtn.addEventListener('click', function(e) {
              e.preventDefault();
              timetableModal.style.display = 'block';
              document.body.style.overflow = 'hidden';
              console.log('Timetable modal opened');
            });
          } else {
            console.error('Create Timetable button or modal not found');
          }
          
          // Close modal
          if (closeTimetableModal) {
            closeTimetableModal.addEventListener('click', function() {
              timetableModal.style.display = 'none';
              document.body.style.overflow = '';
            });
          }
          
          // Close when clicking outside
          timetableModal.addEventListener('click', function(e) {
            if (e.target === this) {
              this.style.display = 'none';
              document.body.style.overflow = '';
            }
          });
          
          // Close with Escape key
          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && timetableModal.style.display === 'block') {
              timetableModal.style.display = 'none';
              document.body.style.overflow = '';
            }
          });
          
          // Handle form submission
          if (timetableForm) {
            timetableForm.addEventListener('submit', (e) => {
              e.preventDefault();
              
              try {
                // Get form values
                const selectedClass = document.getElementById('timetable-class').value;
                const subject = document.getElementById('timetable-subject').value.trim();
                const day = document.getElementById('timetable-day').value;
                const startTime = document.getElementById('timetable-start-time').value;
                const endTime = document.getElementById('timetable-end-time').value;
                const room = document.getElementById('timetable-room').value.trim() || 'TBD';
                
                // Validate required fields
                if (!selectedClass || !subject || !day || !startTime) {
                  throw new Error('Please fill in all required fields');
                }
                
                // Generate a unique ID for this entry
                const entryId = 'entry-' + Date.now();
                
                // Create the entry object
                const newEntry = {
                  id: entryId,
                  class: selectedClass,
                  subject: subject.toLowerCase(),
                  day: day.toLowerCase(),
                  startTime: startTime,
                  endTime: endTime || '',
                  room: room
                };
                
                console.log('New timetable entry:', newEntry);
                
                // Add to timetable and update UI
                addTimetableEntry(newEntry);
                
                // Close the modal
                if (timetableModal) {
                  timetableModal.style.display = 'none';
                  document.body.style.overflow = '';
                }
                
                // Reset the form
                timetableForm.reset();
                
                // Show success message
                alert('Timetable entry created successfully!');
                
              } catch (error) {
                console.error('Error creating timetable entry:', error);
                alert(error.message || 'Failed to create timetable entry. Please try again.');
              }
            });
          }
        });
      </script>
    </section>

    <!-- Report Card Section -->
    <section id="reportcard-section" class="tab-section">
      <div class="section-header">
        <h2>Student Report Cards</h2>
      </div>
      
      <!-- Tab Navigation -->
      <div class="tabs" style="margin: 20px 0 0; border-bottom: 1px solid #ddd; display: flex; gap: 2px;">
        <button class="tab-btn active" data-tab="marks-entry-tab" style="padding: 10px 20px; background: #f8f9fa; border: 1px solid #ddd; border-bottom: none; border-radius: 4px 4px 0 0; cursor: pointer; font-weight: 500; color: #495057; transition: all 0.2s ease;">Marks Entry</button>
        <button class="tab-btn" data-tab="report-card-tab" style="padding: 10px 20px; background: #f8f9fa; border: 1px solid #ddd; border-bottom: none; border-radius: 4px 4px 0 0; cursor: pointer; font-weight: 500; color: #495057; transition: all 0.2s ease;">Generate Report Card</button>
      </div>
      
      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Marks Entry Tab -->
        <div id="marks-entry-tab" class="tab-pane" style="display: block; padding: 20px; background: #fff; border: 1px solid #ddd; border-top: none; border-radius: 0 0 4px 4px;">
          <div class="form-section">
            <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 20px;">
              <div class="form-group" style="flex: 1;">
                <label for="marks-class">Class</label>
                <select id="marks-class" class="form-control" required>
                  <option value="">Select Class</option>
                  <optgroup label="Pre-Primary">
                    <option value="Baby Class">Baby Class</option>
                    <option value="PP1">PP1 (Pre-Primary 1)</option>
                    <option value="PP2">PP2 (Pre-Primary 2)</option>
                  </optgroup>
                  <optgroup label="Lower Primary (Grade 1-3)">
                    <option value="Grade 1">Grade 1</option>
                    <option value="Grade 2">Grade 2</option>
                    <option value="Grade 3">Grade 3</option>
                  </optgroup>
                  <optgroup label="Upper Primary (Grade 4-6)">
                    <option value="Grade 4">Grade 4</option>
                    <option value="Grade 5">Grade 5</option>
                    <option value="Grade 6">Grade 6</option>
                  </optgroup>
                  <optgroup label="Junior Secondary (Grade 7-9)">
                    <option value="Grade 7">Grade 7</option>
                    <option value="Grade 8">Grade 8</option>
                    <option value="Grade 9">Grade 9</option>
                  </optgroup>
                  <optgroup label="Senior School (Grade 10-12)">
                    <option value="Grade 10">Grade 10</option>
                    <option value="Grade 11">Grade 11</option>
                    <option value="Grade 12">Grade 12</option>
                  </optgroup>
                </select>
              </div>
              
              <div class="form-group" style="flex: 1;">
                <label for="marks-student">Student</label>
                <select id="marks-student" class="form-control" required disabled>
                  <option value="">Select Student</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="marks-term">Term</label>
                <select id="marks-term" class="form-control" required>
                  <option value="Term 1">Term 1</option>
                  <option value="Term 2">Term 2</option>
                  <option value="Term 3">Term 3</option>
                </select>
              </div>
            </div>
            
            <!-- Marks Entry Table -->
            <div id="marks-entry-container" style="display: none;">
              <h3>Enter Marks</h3>
              <table class="marks-table" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                <thead>
                  <tr style="background-color: #f8f9fa;">
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Subject</th>
                    <th style="padding: 10px; text-align: center; border: 1px solid #ddd; width: 150px;">Marks (0-100)</th>
                    <th style="padding: 10px; text-align: center; border: 1px solid #ddd; width: 150px;">Grade</th>
                  </tr>
                </thead>
                <tbody id="marks-entry-body">
                  <!-- Marks entry rows will be added here -->
                </tbody>
              </table>
              <div class="form-group">
                <label for="teacher-remarks">Teacher's Remarks</label>
                <textarea id="teacher-remarks" class="form-control" rows="3" style="width: 100%;"></textarea>
              </div>
              <button id="save-marks-btn" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Marks
              </button>
            </div>
          </div>
        </div>
        
        <!-- Report Card Tab -->
        <div id="report-card-tab" class="tab-pane" style="display: none; padding: 20px; background: #fff; border: 1px solid #ddd; border-top: none; border-radius: 0 0 4px 4px;">
          <div class="report-card-controls" style="margin-bottom: 20px;">
            <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
              <div class="form-group" style="flex: 1;">
                <label for="report-class">Select Class:</label>
                <select id="report-class" class="form-control" required>
                  <option value="">-- Select Class --</option>
                </select>
              </div>
              <div class="form-group" style="flex: 1;">
                <label for="report-student">Select Student:</label>
                <select id="report-student" class="form-control" required disabled>
                  <option value="">-- Select Student --</option>
                </select>
              </div>
              <div class="form-group">
                <label for="report-term">Term:</label>
                <select id="report-term" class="form-control" required>
                  <option value="Term 1">Term 1</option>
                  <option value="Term 2">Term 2</option>
                  <option value="Term 3">Term 3</option>
                </select>
              </div>
              <div class="form-group" style="align-self: flex-end;">
                <button id="generate-report-card" class="btn btn-primary">
                  <i class="fas fa-eye"></i> Generate Report Card
                </button>
              </div>
            </div>
          </div>
          
          <!-- Report Card Preview -->
          <div id="report-card-preview" class="report-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <div style="text-align: center; margin-bottom: 20px;">
              <h2 style="margin: 0; color: #2c3e50;">SCHOOL REPORT CARD</h2>
              <div id="report-term-display" style="font-size: 1.1em; color: #7f8c8d; margin: 5px 0 15px 0;"></div>
            </div>
            
            <div class="student-info" style="margin-bottom: 20px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <div><strong>Student Name:</strong> <span id="student-name">-</span></div>
                <div><strong>Class:</strong> <span id="student-class">-</span></div>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <div><strong>Admission No:</strong> <span id="admission-no">-</span></div>
                <div><strong>Term:</strong> <span id="term-display">-</span></div>
              </div>
            </div>
            
            <div class="marks-table" style="margin-bottom: 20px;">
              <table style="width: 100%; border-collapse: collapse;">
                <thead>
                  <tr style="background-color: #f8f9fa;">
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Subject</th>
                    <th style="padding: 10px; text-align: center; border: 1px solid #ddd; width: 100px;">Marks</th>
                    <th style="padding: 10px; text-align: center; border: 1px solid #ddd; width: 100px;">Grade</th>
                    <th style="padding: 10px; text-align: center; border: 1px solid #ddd; width: 150px;">Remarks</th>
                  </tr>
                </thead>
                <tbody id="marks-table-body">
                  <!-- Marks will be populated here -->
                </tbody>
              </table>
            </div>
            
            <div class="summary" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <div><strong>Total Marks:</strong> <span id="total-marks">-</span></div>
                <div><strong>Average Score:</strong> <span id="average-score">-</span></div>
                <div><strong>Overall Grade:</strong> <span id="overall-grade">-</span></div>
              </div>
              <div><strong>Class Teacher's Remarks:</strong> <span id="teacher-remarks-preview">-</span></div>
              <div style="margin-top: 20px; text-align: right;">
                <div style="margin-bottom: 5px;">_______________________</div>
                <div>Class Teacher's Signature</div>
              </div>
            </div>
          </div>
          
          <div style="margin-top: 20px; text-align: center;">
            <button id="download-pdf" class="btn btn-success" style="display: none; margin-right: 10px;">
              <i class="fas fa-download"></i> Download PDF
            </button>
            <button id="send-to-student" class="btn btn-primary" style="display: none; margin-right: 10px;">
              <i class="fas fa-paper-plane"></i> Send to Student
            </button>
            <button type="button" id="delete-report" class="btn btn-danger" style="display: none; margin-right: 10px;">
              <i class="fas fa-trash"></i> Delete Report Card
            </button>
          </div>
          
          <!-- Delete Confirmation Modal -->
          <div id="confirmDeleteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 2000; overflow: auto;">
            <div style="position: relative; margin: 10% auto; max-width: 500px; width: 90%;">
              <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
                <div style="background: #dc3545; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
                  <h5 style="margin: 0;">
                    <i class="fas fa-exclamation-triangle me-2"></i>Confirm Deletion
                  </h5>
                  <button id="closeDeleteModal" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">
                    &times;
                  </button>
                </div>
                <div style="padding: 20px;">
                  <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <i class="fas fa-exclamation-circle" style="color: #dc3545; font-size: 1.5rem; margin-right: 10px;"></i>
                    <p style="margin: 0;">Are you sure you want to delete this report card? This action cannot be undone.</p>
                  </div>
                  <div style="background-color: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; border-left: 4px solid #ffeeba; margin-bottom: 0;">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Warning:</strong> All marks and grades for this student and term will be permanently deleted.
                  </div>
                </div>
                <div style="padding: 15px 20px; text-align: right; border-top: 1px solid #dee2e6;">
                  <button id="cancelDeleteBtn" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px; cursor: pointer;">
                    <i class="fas fa-times me-1"></i> Cancel
                  </button>
                  <button id="confirmDeleteBtn" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                    <i class="fas fa-trash me-1"></i> Delete Permanently
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <style>
            /* Custom Modal Styling */
            #confirmDeleteModal {
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              z-index: 1050;
              overflow: auto;
              background-color: rgba(0,0,0,0.5);
            }
            
            #confirmDeleteModal.show {
              display: block;
            }
            
            #confirmDeleteModal .modal-dialog {
              margin: 1.75rem auto;
              max-width: 500px;
              width: 90%;
            }
            
            #confirmDeleteModal .modal-content {
              border: none;
              border-radius: 8px;
              box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            }
            
            #confirmDeleteModal .modal-header {
              border-radius: 8px 8px 0 0;
              padding: 15px 20px;
              border-bottom: 1px solid #dee2e6;
            }
            
            #confirmDeleteModal .modal-body {
              padding: 20px;
            }
            
            #confirmDeleteModal .modal-footer {
              border-top: 1px solid #dee2e6;
              padding: 15px 20px;
            }
            
            #confirmDeleteModal .close {
              font-size: 1.5rem;
              line-height: 1;
              opacity: 1;
              color: #fff;
            }
            
            #confirmDeleteModal .close:hover {
              opacity: 0.8;
            }
          </style>
          
          <style>
            /* Modal Backdrop Styling */
            .modal-backdrop {
              background-color: rgba(0, 0, 0, 0.5) !important;
              opacity: 1 !important;
            }
            
            /* Modal Animation */
            .modal.fade .modal-dialog {
              transform: translate(0, -50px);
              transition: transform 0.3s ease-out;
            }
            
            .modal.show .modal-dialog {
              transform: translate(0, 0);
            }
            
            /* Modal Content Styling */
            .modal-content {
              border: none;
              border-radius: 8px;
              overflow: hidden;
            }
            
            /* Button Styling */
            #confirm-delete-btn {
              transition: all 0.2s ease;
            }
            
            #confirm-delete-btn:hover {
              transform: translateY(-1px);
              box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
            }
            
            #confirm-delete-btn:active {
              transform: translateY(0);
              box-shadow: none;
            }
          </style>
        </div>
      </div>
    </section>

    <!-- Attendance Section -->
    <section id="attendance-section" class="tab-section">
      <h2>Student Attendance</h2>
      
      <!-- Past Attendance Records -->
      <div class="form-section mb-4">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="past-class">
                <i class="fas fa-chalkboard-teacher"></i> Select Class
              </label>
              <select id="past-class" class="form-control">
                <option value="">Select Class</option>
                <optgroup label="Primary School">
                  <option value="Grade 1">Grade 1</option>
                  <option value="Grade 2">Grade 2</option>
                  <option value="Grade 3">Grade 3</option>
                  <option value="Grade 4">Grade 4</option>
                  <option value="Grade 5">Grade 5</option>
                  <option value="Grade 6">Grade 6</option>
                  <option value="Grade 7">Grade 7</option>
                  <option value="Grade 8">Grade 8</option>
                </optgroup>
                <optgroup label="Secondary School">
                  <option value="Form 1">Form 1</option>
                  <option value="Form 2">Form 2</option>
                  <option value="Form 3">Form 3</option>
                  <option value="Form 4">Form 4</option>
                </optgroup>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="date-range">
                <i class="far fa-calendar-alt"></i> Date Range
              </label>
              <div class="input-group">
                <input type="date" id="start-date" class="form-control" placeholder="Start Date">
                <div class="input-group-append">
                  <span class="input-group-text">to</span>
                </div>
                <input type="date" id="end-date" class="form-control" placeholder="End Date">
              </div>
            </div>
          </div>
        </div>
        
        <div class="mt-3">
          <button id="view-attendance-btn" class="btn btn-primary" style="display: block;">
            <i class="fas fa-search"></i> View Attendance Records
          </button>
        </div>
        
        <div id="past-attendance-list" class="mt-4" style="display: none;">
          <h4>Attendance Records</h4>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead class="thead-light">
                <tr>
                  <th>Date</th>
                  <th>Class</th>
                  <th>Present</th>
                  <th>Absent</th>
                  <th>Total</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="past-attendance-records">
                <!-- Attendance records will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- Current Attendance -->
      <div class="form-section">
        <div class="form-group">
          <label for="attendance-class">
            <i class="fas fa-chalkboard-teacher"></i> Select Class
          </label>
          <select id="attendance-class" class="form-control" required>
            <option value="">Select Class</option>
            <optgroup label="Primary School">
              <option value="Grade 1">Grade 1</option>
              <option value="Grade 2">Grade 2</option>
              <option value="Grade 3">Grade 3</option>
              <option value="Grade 4">Grade 4</option>
              <option value="Grade 5">Grade 5</option>
              <option value="Grade 6">Grade 6</option>
              <option value="Grade 7">Grade 7</option>
              <option value="Grade 8">Grade 8</option>
            </optgroup>
            <optgroup label="Secondary School">
              <option value="Form 1">Form 1</option>
              <option value="Form 2">Form 2</option>
              <option value="Form 3">Form 3</option>
              <option value="Form 4">Form 4</option>
            </optgroup>
          </select>
        </div>
        
        <div class="form-group">
          <label for="attendance-date">
            <i class="far fa-calendar-alt"></i> Date
          </label>
          <input type="date" id="attendance-date" class="form-control" required>
        </div>
        
        <div id="students-list" class="mt-4" style="display: none;">
          <h4>Mark Attendance</h4>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead class="thead-light">
                <tr>
                  <th>Student Name</th>
                  <th>Status</th>
                  <th>Remarks</th>
                </tr>
              </thead>
              <tbody id="attendance-students-list">
                <!-- Students will be loaded here -->
              </tbody>
            </table>
          </div>
          <button id="save-attendance-btn" class="btn btn-primary mt-3">
            <i class="fas fa-save"></i> Save Attendance
          </button>
        </div>
      </div>
      
      <!-- Attendance Summary -->
      <div id="attendance-summary" class="mt-4" style="display: none;">
        <h4>Today's Attendance Summary</h4>
        <div class="row">
          <div class="col-md-4">
            <div class="card bg-light">
              <div class="card-body text-center">
                <h5 class="card-title">Present</h5>
                <h2 id="present-count">0</h2>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card bg-light">
              <div class="card-body text-center">
                <h5 class="card-title">Absent</h5>
                <h2 id="absent-count">0</h2>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card bg-light">
              <div class="card-body text-center">
                <h5 class="card-title">Total</h5>
                <h2 id="total-count">0</h2>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Announcements Section -->
    <section id="announcements-section" class="tab-section">
      <h2>Announcements</h2>
      <div class="form-section">
        <p>Post announcements for your students.</p>
        <form id="announcement-form">
          <div class="form-group">
            <label for="announcement-text">New Announcement</label>
            <textarea id="announcement-text" rows="4" placeholder="Enter announcement here..."></textarea>
          </div>
          <button type="submit">Post Announcement</button>
        </form>
        <div id="announcements">
          <ul id="announcements-list" style="list-style: none; padding: 0;">
            <li class="announcement-item" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 12px; margin-bottom: 10px; background-color: #f8f9fa; border-radius: 6px; border-left: 4px solid #3498db;">
              <div>
                <strong>Exam Reminder:</strong> Midterm exam scheduled for Mar 15.
                <div class="announcement-meta" style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">
                  Posted on: Mar 1, 2025
                </div>
              </div>
              <button class="delete-announcement-btn" style="background: none; border: 1px solid #e74c3c; color: #e74c3c; border-radius: 4px; padding: 4px 8px; cursor: pointer; transition: all 0.2s ease;" title="Delete Announcement">
                <i class="fas fa-trash"></i>
              </button>
            </li>
            <li class="announcement-item" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 12px; margin-bottom: 10px; background-color: #f8f9fa; border-radius: 6px; border-left: 4px solid #3498db;">
              <div>
                <strong>Homework:</strong> Submit science project reports by Mar 10.
                <div class="announcement-meta" style="font-size: 0.85em; color: #6c757d; margin-top: 5px;">
                  Posted on: Feb 25, 2025
                </div>
              </div>
              <button class="delete-announcement-btn" style="background: none; border: 1px solid #e74c3c; color: #e74c3c; border-radius: 4px; padding: 4px 8px; cursor: pointer; transition: all 0.2s ease;" title="Delete Announcement">
                <i class="fas fa-trash"></i>
              </button>
            </li>
          </ul>
        </div>
    </section>

    <!-- Resources Section -->
    <section id="resources-section" class="tab-section">
      <h2>Resources</h2>
      <div class="form-section">
        <p>Upload or share study materials (PDF, DOC, DOCX only).</p>
        <button id="upload-resource-btn" class="modern-btn">Upload Resource</button>

        <!-- Upload Form (initially hidden) -->
        <div id="upload-form-container" style="display: none;">
          <form id="upload-form" style="margin-bottom: 15px;">
            <input type="file" id="resource-file" accept=".pdf,.doc,.docx" style="margin-bottom: 10px; display: block;" required />
            <div id="resource-class" style="margin-bottom: 10px; display: block;">
              <label for="class-select" style="display: block; margin-bottom: 5px;">Select Class:</label>
              <select id="class-select" class="form-control" style="width: 100%;" required>
                <option value="">-- Select a class --</option>
                <optgroup label="Primary School">
                  <option value="Grade 1">Grade 1</option>
                  <option value="Grade 2">Grade 2</option>
                  <option value="Grade 3">Grade 3</option>
                  <option value="Grade 4">Grade 4</option>
                  <option value="Grade 5">Grade 5</option>
                  <option value="Grade 6">Grade 6</option>
                  <option value="Grade 7">Grade 7</option>
                  <option value="Grade 8">Grade 8</option>
                </optgroup>
                <optgroup label="Secondary School">
                  <option value="Form 1">Form 1</option>
                  <option value="Form 2">Form 2</option>
                  <option value="Form 3">Form 3</option>
                  <option value="Form 4">Form 4</option>
                </optgroup>
              </select>
            </div>
            <div id="upload-status" style="display: none; margin: 10px 0;"></div>
            <div style="display: flex; gap: 10px;">
              <button type="submit" class="modern-btn">Submit Resource</button>
              <button id="cancel-upload-btn" class="modern-btn btn-cancel">Cancel</button>
            </div>
          </form>
        </div>
      </div>
      <!-- List of shared resources -->
      <div id="resources-list">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3>Available Resources</h3>
          <div>
            <label for="class-filter" style="margin-right: 10px;">Filter by Class:</label>
            <select id="class-filter" class="form-control" style="width: auto;">
              <option value="all">All Classes</option>
              <optgroup label="Primary School">
                <option value="Grade 1">Grade 1</option>
                <option value="Grade 2">Grade 2</option>
                <option value="Grade 3">Grade 3</option>
                <option value="Grade 4">Grade 4</option>
                <option value="Grade 5">Grade 5</option>
                <option value="Grade 6">Grade 6</option>
                <option value="Grade 7">Grade 7</option>
                <option value="Grade 8">Grade 8</option>
              </optgroup>
              <optgroup label="Secondary School">
                <option value="Form 1">Form 1</option>
                <option value="Form 2">Form 2</option>
                <option value="Form 3">Form 3</option>
                <option value="Form 4">Form 4</option>
              </optgroup>
            </select>
          </div>
        </div>
        <ul id="resource-list"></ul>
      </div>
    </section>

    <!-- Communication Section -->
    <section id="communication-section" class="tab-section">
      <h2>Communication</h2>
      <div class="form-section">
        <p>Send messages to students or parents.</p>
        <form id="communication-form">
          <div class="form-group">
            <label for="message-recipient">Recipient</label>
            <select id="message-recipient">
              <option value="all-students">All Students</option>
              <option value="all-parents">All Parents</option>
              <option value="individual">Individual</option>
            </select>
          </div>
          <div class="form-group">
            <label for="message-text">Message</label>
            <textarea id="message-text" rows="4" placeholder="Enter your message here..."></textarea>
          </div>
          <button type="submit">Send Message</button>
        </form>
        <div id="communication-log">
          <ul>
            <li><strong>To All Students:</strong> Reminder to submit assignments by Feb 25.</li>
            <li><strong>To Parents:</strong> Upcoming parent-teacher meeting scheduled for Mar 10.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Logout Section -->
    <section id="logout-section" class="tab-section">
      <h2>You are logged out!</h2>
      <button onclick="window.location.href='login.html'">Go to Login Page</button>
    </section>
  </main>

  <!-- Add the teacher.js script -->
  <script src="../js/teacher.js"></script>
  
  <style>
    /* Loading spinner */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .spinner-border {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      vertical-align: text-bottom;
      border: 0.2em solid currentColor;
      border-right-color: transparent;
      border-radius: 50%;
      animation: spin .75s linear infinite;
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      overflow-y: auto;
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 25px;
      border: 1px solid #888;
      width: 90%;
      max-width: 800px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 15px;
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .modal-header h3 {
      margin: 0;
      color: #333;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
      padding: 0;
      line-height: 1;
    }
    
    .close-modal:hover {
      color: #333;
    }
    
    /* Form styles */
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #444;
    }
    
    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      font-family: inherit;
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    /* Button styles */
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    .btn-primary {
      background-color: #007bff;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #0056b3;
    }
    
    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }
    
    .btn-secondary:hover {
      background-color: #5a6268;
    }
    
    .btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }
    
    /* Spinner animation */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .spinner-btn {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 0.8s ease-in-out infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .modal-content {
        width: 95%;
        margin: 10% auto;
        padding: 15px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 15px;
      }
      
      .form-group {
        min-width: 100% !important;
      }
    }
    
    /* Class Management Styles */
    .class-management-container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    
    .class-selection-panel {
      flex: 1;
      min-width: 350px;
      max-width: 400px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .class-list-container,
    .student-list-container {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 15px;
    }
    
    .class-list,
    .student-list {
      margin-top: 10px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .class-item {
      padding: 12px 15px;
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .class-item:hover {
      background-color: #f1f8ff;
      border-color: #90caf9;
    }
    
    .class-item.active {
      background-color: #e3f2fd;
      border-color: #64b5f6;
    }
    
    .class-name {
      font-weight: 600;
      color: #1976d2;
      margin-bottom: 4px;
    }
    
    .class-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.85em;
      color: #666;
    }
    
    .student-item {
      display: flex;
      align-items: center;
      padding: 10px;
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .student-item:hover {
      background-color: #f5f5f5;
    }
    
    .student-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #e3f2fd;
      color: #1976d2;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-right: 12px;
      flex-shrink: 0;
    }
    
    .student-info {
      flex: 1;
      min-width: 0;
    }
    
    .student-name {
      font-weight: 500;
      margin: 0 0 2px 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .student-id {
      font-size: 0.8em;
      color: #666;
      margin: 0;
    }
    
    .student-profile-panel {
      flex: 2;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 25px;
      min-height: 500px;
    }
    
    .empty-state,
    .empty-profile {
      text-align: center;
      color: #9e9e9e;
      padding: 30px 20px;
    }
    
    .empty-profile i {
      font-size: 48px;
      color: #e0e0e0;
      margin-bottom: 15px;
      display: block;
    }
    
    .empty-profile p {
      margin: 10px 0 0;
      font-size: 1.1em;
    }
    
    .profile-header {
      display: flex;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }
    
    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: #e3f2fd;
      color: #1976d2;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 600;
      margin-right: 20px;
      flex-shrink: 0;
    }
    
    .profile-details h3 {
      margin: 0 0 5px 0;
      color: #333;
    }
    
    .profile-details p {
      margin: 0;
      color: #666;
    }
    
    .profile-section {
      margin-bottom: 25px;
    }
    
    .profile-section h4 {
      color: #1976d2;
      margin: 0 0 15px 0;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 12px 15px;
    }
    
    .info-label {
      font-weight: 500;
      color: #555;
    }
    
    .profile-actions {
      display: flex;
      gap: 10px;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    
    @media (max-width: 1024px) {
      .class-management-container {
        flex-direction: column;
      }
      
      .class-selection-panel {
        max-width: 100%;
      }
      
      .student-profile-panel {
        min-height: auto;
      }
    }
  </style>
  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Sidebar Toggle Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Sidebar toggle functionality
      const sidebar = document.querySelector('.sidebar');
      const sidebarToggle = document.querySelector('.sidebar-toggle');
      const mainContent = document.querySelector('.main-content');
      
      // Toggle sidebar on button click
      if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
          sidebar.classList.toggle('active');
          document.body.classList.toggle('sidebar-active');
        });
      }
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(event) {
        const isClickInside = sidebar.contains(event.target) || 
                            (sidebarToggle && sidebarToggle.contains(event.target));
        
        if (!isClickInside && window.innerWidth <= 1024) {
          sidebar.classList.remove('active');
          document.body.classList.remove('sidebar-active');
        }
      });
      
      // Tab switching functionality
      const tabLinks = document.querySelectorAll('.tab-link');
      const tabSections = document.querySelectorAll('.tab-section');
      
      tabLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          // Don't prevent default for links that have onclick handlers
          if (!this.getAttribute('onclick')) {
            e.preventDefault();
          }
          
          const targetTab = this.getAttribute('data-tab');
          
          // Remove active class from all links
          tabLinks.forEach(l => l.classList.remove('active'));
          // Add active class to clicked link
          this.classList.add('active');
          
          // Hide all sections
          tabSections.forEach(section => {
            section.style.display = 'none';
          });
          
          // Show target section
          const targetSection = document.getElementById(targetTab);
          if (targetSection) {
            targetSection.style.display = 'block';
          }
          
          // Close sidebar on mobile after clicking a link
          if (window.innerWidth <= 1024) {
            sidebar.classList.remove('active');
            document.body.classList.remove('sidebar-active');
          }
        });
      });
      
      // Show first section by default if none is active
      const activeTab = document.querySelector('.tab-link.active');
      if (activeTab) {
        activeTab.click();
      } else if (tabLinks.length > 0) {
        tabLinks[0].classList.add('active');
        const firstSection = document.querySelector('.tab-section');
        if (firstSection) firstSection.style.display = 'block';
      }
    });
  </script>
  
  <!-- Custom Scripts -->
  <script src="../js/teacher.js"></script>
  <script src="../js/report-cards.js"></script>
  <script src="../js/modal-fix.js"></script>
  <script src="../js/profile.js"></script>
  <script src="../js/resources.js"></script>
  <script src="../js/assignments.js"></script>
  
  <script>
    // Kenyan curriculum subjects by level
    const subjectsByLevel = {
      'Grade 1': [
        'English', 'Kiswahili', 'Mathematics', 'Environmental Activities', 
        'Hygiene and Nutrition', 'Religious Education', 'Creative Activities'
      ],
      'Grade 2': [
        'English', 'Kiswahili', 'Mathematics', 'Environmental Activities', 
        'Hygiene and Nutrition', 'Religious Education', 'Creative Activities'
      ],
      'Grade 3': [
        'English', 'Kiswahili', 'Mathematics', 'Environmental Activities', 
        'Hygiene and Nutrition', 'Religious Education', 'Creative Activities'
      ],
      'Grade 4': [
        'English', 'Kiswahili', 'Mathematics', 'Science and Technology', 
        'Social Studies', 'Religious Education', 'Creative Arts and Sports',
        'Agriculture', 'Home Science', 'Life Skills'
      ],
      'Grade 5': [
        'English', 'Kiswahili', 'Mathematics', 'Science and Technology', 
        'Social Studies', 'Religious Education', 'Creative Arts and Sports',
        'Agriculture', 'Home Science', 'Life Skills'
      ],
      'Grade 6': [
        'English', 'Kiswahili', 'Mathematics', 'Science and Technology', 
        'Social Studies', 'Religious Education', 'Creative Arts and Sports',
        'Agriculture', 'Home Science', 'Life Skills'
      ],
      'Grade 7': ['English', 'Kiswahili', 'Mathematics', 'Integrated Science', 'Health Education', 'Pre-Technical Studies', 'Computer Studies', 'Business Studies', 'Agriculture', 'Life Skills', 'Sports and Physical Education', 'Religious Education', 'Social Studies', 'Performing Arts', 'Visual Arts', 'Home Science', 'Foreign Languages'],
      'Grade 8': ['English', 'Kiswahili', 'Mathematics', 'Integrated Science', 'Health Education', 'Pre-Technical Studies', 'Computer Studies', 'Business Studies', 'Agriculture', 'Life Skills', 'Sports and Physical Education', 'Religious Education', 'Social Studies', 'Performing Arts', 'Visual Arts', 'Home Science', 'Foreign Languages'],
      'Grade 9': ['English', 'Kiswahili', 'Mathematics', 'Integrated Science', 'Health Education', 'Pre-Technical Studies', 'Computer Studies', 'Business Studies', 'Agriculture', 'Life Skills', 'Sports and Physical Education', 'Religious Education', 'Social Studies', 'Performing Arts', 'Visual Arts', 'Home Science', 'Foreign Languages'],
      'Form 1': ['English', 'Kiswahili', 'Mathematics', 'Biology', 'Physics', 'Chemistry', 'Geography', 'History', 'CRE', 'IRE', 'HRE', 'Business Studies', 'Agriculture', 'Computer Studies', 'Home Science', 'Art and Design', 'Music', 'French', 'German', 'Arabic', 'Sign Language', 'Aviation Technology', 'Marine and Fisheries', 'Wood Technology', 'Electrical Technology', 'Metal Technology', 'Power Mechanics', 'Building Construction', 'Drawing and Design', 'Electricity', 'Clothing and Textiles', 'Food and Nutrition'],
      'Form 2': ['English', 'Kiswahili', 'Mathematics', 'Biology', 'Physics', 'Chemistry', 'Geography', 'History', 'CRE', 'IRE', 'HRE', 'Business Studies', 'Agriculture', 'Computer Studies', 'Home Science', 'Art and Design', 'Music', 'French', 'German', 'Arabic', 'Sign Language', 'Aviation Technology', 'Marine and Fisheries', 'Wood Technology', 'Electrical Technology', 'Metal Technology', 'Power Mechanics', 'Building Construction', 'Drawing and Design', 'Electricity', 'Clothing and Textiles', 'Food and Nutrition'],
      'Form 3': ['English', 'Kiswahili', 'Mathematics', 'Biology', 'Physics', 'Chemistry', 'Geography', 'History', 'CRE', 'IRE', 'HRE', 'Business Studies', 'Agriculture', 'Computer Studies', 'Home Science', 'Art and Design', 'Music', 'French', 'German', 'Arabic', 'Sign Language', 'Aviation Technology', 'Marine and Fisheries', 'Wood Technology', 'Electrical Technology', 'Metal Technology', 'Power Mechanics', 'Building Construction', 'Drawing and Design', 'Electricity', 'Clothing and Textiles', 'Food and Nutrition'],
      'Form 4': ['English', 'Kiswahili', 'Mathematics', 'Biology', 'Physics', 'Chemistry', 'Geography', 'History', 'CRE', 'IRE', 'HRE', 'Business Studies', 'Agriculture', 'Computer Studies', 'Home Science', 'Art and Design', 'Music', 'French', 'German', 'Arabic', 'Sign Language', 'Aviation Technology', 'Marine and Fisheries', 'Wood Technology', 'Electrical Technology', 'Metal Technology', 'Power Mechanics', 'Building Construction', 'Drawing and Design', 'Electricity', 'Clothing and Textiles', 'Food and Nutrition']
    };

    // Function to load subjects based on selected class
    function loadSubjectsForClass(className) {
      console.log('Loading subjects for class:', className);
      const marksEntryContainer = document.getElementById('marks-entry-container');
      const marksEntryBody = document.getElementById('marks-entry-body');
      
      if (!marksEntryContainer || !marksEntryBody) {
        console.error('Marks entry container or body not found');
        return;
      }
      
      try {
        // Clear any saved marks data for the current class
        const savedMarksKey = `savedMarks_${className}`;
        localStorage.removeItem(savedMarksKey);
        console.log('Cleared saved marks data for class:', className);
      } catch (e) {
        console.error('Error clearing saved marks data:', e);
      }
      
      // Clear existing subjects
      marksEntryBody.innerHTML = '';
      
      // Get subjects for the class
      const subjects = subjectsByLevel[className];
      console.log('Loading subjects for', className, ':', subjects);
      
      if (!subjects || subjects.length === 0) {
        console.error('No subjects defined for class:', className);
        marksEntryBody.innerHTML = '<tr><td colspan="3">No subjects found for this class.</td></tr>';
        return;
      }
      
      // Create table rows for each subject
      const fragment = document.createDocumentFragment();
      
      subjects.forEach((subject) => {
        const row = document.createElement('tr');
        const subjectId = subject.replace(/\s+/g, '-').toLowerCase();
        
        row.innerHTML = `
          <td style="padding: 10px; border: 1px solid #ddd;">${subject}</td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
            <input type="number" 
                   class="form-control marks-input" 
                   min="0" 
                   max="100" 
                   id="marks-${subjectId}" 
                   data-subject="${subjectId}"
                   style="width: 80px; margin: 0 auto; text-align: center;"
                   placeholder="0-100"
                   value="">
          </td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
            <span id="grade-${subjectId}" class="grade-display">-</span>
          </td>
        `;
        
        fragment.appendChild(row);
      });
      
      // Clear and append new content
      marksEntryBody.innerHTML = '';
      marksEntryBody.appendChild(fragment);
      
      // Show the container
      marksEntryContainer.style.display = 'block';
      console.log('Marks entry container displayed - ready for new entry');
      
      // Add event delegation for marks input
      marksEntryBody.addEventListener('input', (e) => {
        if (e.target.classList.contains('marks-input')) {
          const marks = e.target.value ? parseInt(e.target.value) : '';
          const subject = e.target.dataset.subject;
          const gradeCell = document.querySelector(`#grade-${subject}`);
          
          if (gradeCell) {
            gradeCell.textContent = marks !== '' ? getGradeFromMarks(marks) : '-';
          }
        }
      });
      
      // Load students for the selected class
      loadStudentsForClass(className);
    }

    // Function to calculate grade from marks using the four-point scale
    function getGradeFromMarks(marks) {
      if (marks >= 75) return 'Exceed Expectation';
      if (marks >= 50) return 'Meet Expectation';
      if (marks >= 30) return 'Approach Expectation';
      return 'Below Expectation';
    }

    // Function to load students for the selected class
    async function loadStudentsForClass(className) {
      console.log('Loading students for class:', className);
      const studentSelect = document.getElementById('marks-student');
      
      if (!studentSelect) {
        console.error('Student select element not found');
        return;
      }
      
      // Show loading state
      studentSelect.innerHTML = '<option value="">Loading students...</option>';
      studentSelect.disabled = true;
      
      try {
        const API_BASE_URL = 'http://localhost:5000/api';
        const token = localStorage.getItem('token');
        
        if (!token) {
          throw new Error('No authentication token found. Please log in again.');
        }
        
        const headers = {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        };
        
        let students = [];
        
        try {
          // First, try to fetch students for the specific class
          let response = await fetch(`${API_BASE_URL}/users?role=student&class=${encodeURIComponent(className)}`, {
            headers: headers
          });
          
          if (response.ok) {
            const data = await response.json();
            students = Array.isArray(data) ? data : [];
          }
          
          // If no students found for the class, try fetching all students
          if (students.length === 0) {
            const allResponse = await fetch(`${API_BASE_URL}/users?role=student`, {
              headers: headers
            });
            
            if (allResponse.ok) {
              const allData = await allResponse.json();
              students = Array.isArray(allData) ? allData : [];
            } else {
              throw new Error(`HTTP error! status: ${allResponse.status}`);
            }
          }
          
        } catch (fetchError) {
          console.warn('Error fetching students:', fetchError);
          // Continue with empty students array to try the next approach
        }
        
        // Update the UI
        studentSelect.innerHTML = '<option value="">Select Student</option>';
        
        if (students.length === 0) {
          studentSelect.innerHTML = '<option value="">No students found</option>';
          return;
        }
        
        // Filter students by class if we have a class name
        if (className) {
          students = students.filter(student => {
            const studentClass = student.class || student.studentClass || student.grade;
            return studentClass && studentClass.toLowerCase().includes(className.toLowerCase());
          });
          
          if (students.length === 0) {
            studentSelect.innerHTML = `<option value="">No students in ${className}</option>`;
            return;
          }
        }
        
        // Add students to dropdown
        students.forEach(student => {
          // Skip if student doesn't have a name or ID
          if (!student._id && !student.id) return;
          
          const option = document.createElement('option');
          option.value = student._id || student.id;
          // Try different possible name fields
          option.textContent = student.fullName || student.name || 
                             `${student.firstName || ''} ${student.lastName || ''}`.trim() || 
                             `Student ${student._id || student.id}`;
          studentSelect.appendChild(option);
        });
        
        studentSelect.disabled = false;
        
      } catch (error) {
        console.error('Error in loadStudentsForClass:', error);
        studentSelect.innerHTML = '<option value="">Error loading students</option>';
        // Only show alert for non-404 errors to avoid spamming the user
        if (!error.message.includes('404')) {
          console.error('Failed to load students:', error);
        }
      }
    }

    // Global flag to prevent marks loading
    let preventMarksLoading = false;

    // Function to clear all saved marks (both local and API)
    async function clearSavedMarks() {
      if (confirm('Are you sure you want to clear all saved marks? This action cannot be undone.')) {
        try {
          // Clear all marks-related localStorage data
          // Clear both individual class marks and general saved marks
          const marksKeys = Object.keys(localStorage)
            .filter(key => key.startsWith('savedMarks_') || 
                    key.startsWith('marks-') || 
                    key.startsWith('reportCard-') ||
                    key === 'savedMarks');
          
          marksKeys.forEach(key => localStorage.removeItem(key));

          // Clear displayed marks
          const marksEntryBody = document.getElementById('marks-entry-body');
          if (marksEntryBody) {
            marksEntryBody.innerHTML = '';
          }

          // Reset student selection
          const studentSelect = document.getElementById('marks-student');
          if (studentSelect) {
            studentSelect.value = '';
            studentSelect.disabled = true;
            studentSelect.innerHTML = '<option value="">Select Student</option>';
          }

          // Reset teacher remarks
          const remarksElement = document.getElementById('teacher-remarks');
          if (remarksElement) {
            remarksElement.value = '';
          }

          // Hide the marks entry container
          const marksEntryContainer = document.getElementById('marks-entry-container');
          if (marksEntryContainer) {
            marksEntryContainer.style.display = 'none';
          }

          // Get current class
          const className = document.getElementById('marks-class').value;
          if (className) {
            // Clear any saved marks data for this class
            const savedMarksKey = `savedMarks_${className}`;
            localStorage.removeItem(savedMarksKey);
            
            // Clear the general saved marks object
            localStorage.removeItem('savedMarks');
            
            // Clear the marks entry form data
            const marksForm = document.getElementById('marks-form');
            if (marksForm) {
              marksForm.reset();
            }
            
            // Clear the marks data object
            const marksDataObj = {
              studentId: '',
              term: '',
              subjects: [],
              teacherRemarks: ''
            };
            
            // Store the empty marks data object
            localStorage.setItem('savedMarks', JSON.stringify(marksDataObj));
            
            // Show a message indicating that marks have been cleared locally
            alert('All marks have been cleared from local storage. Note: This does not affect marks stored on the server.');

            // Dispatch marks cleared event
            const marksClearedEvent = new CustomEvent('marksCleared');
            document.dispatchEvent(marksClearedEvent);
          }
        } catch (error) {
          console.error('Error clearing marks:', error);
          alert('Failed to clear marks. Please try again.');
        }
      }
    }

    // Function to check if marks loading should be prevented
    function shouldPreventMarksLoading() {
      if (preventMarksLoading) {
        preventMarksLoading = false; // Reset the flag after checking
        return true;
      }
      return false;
    }

    // Function to initialize the marks entry system
    function initializeMarksEntrySystem() {
      console.log('Initializing marks entry system...');
      
      const marksClassSelect = document.getElementById('marks-class');
      const marksContainer = document.getElementById('marks-entry-container');
      const marksEntryBody = document.getElementById('marks-entry-body');
      
      // Check if required elements exist
      if (!marksClassSelect || !marksContainer || !marksEntryBody) {
        console.error('Required elements not found:', {
          marksClassSelect: !!marksClassSelect,
          marksContainer: !!marksContainer,
          marksEntryBody: !!marksEntryBody
        });
        return;
      }
      
      console.log('All required elements found');
      
      // Ensure the marks container is initially hidden
      marksContainer.style.display = 'none';
      
      // Function to handle class selection change
      function handleClassChange() {
        const selectedClass = marksClassSelect.value;
        const studentSelect = document.getElementById('marks-student');
        
        console.log('Class selection changed to:', selectedClass);
        
        if (selectedClass) {
          // Enable student selection
          if (studentSelect) {
            studentSelect.disabled = false;
          }
          
          // Load subjects for the selected class
          loadSubjectsForClass(selectedClass);
        } else {
          // Disable student selection and hide marks entry
          if (studentSelect) {
            studentSelect.disabled = true;
          }
          marksContainer.style.display = 'none';
        }
      }
      
      // Add event listener for class selection
      marksClassSelect.addEventListener('change', handleClassChange);
      
      // Initialize the year dropdown
      const yearSelect = document.getElementById('marks-year');
      if (yearSelect) {
        const currentYear = new Date().getFullYear();
        
        // Clear any existing options
        yearSelect.innerHTML = '';
        
        // Add 5 years in the past and 2 years in the future
        for (let year = currentYear - 5; year <= currentYear + 2; year++) {
          const option = document.createElement('option');
          option.value = year;
          option.textContent = year;
          if (year === currentYear) {
            option.selected = true;
          }
          yearSelect.appendChild(option);
        }
      }
      
      // Trigger initial load if a class is already selected
      if (marksClassSelect.value) {
        console.log('Initial class selected:', marksClassSelect.value);
        handleClassChange();
      }
      
      console.log('Marks entry system initialized');
    }
    
    // Add event listener for clear marks button
    document.addEventListener('click', function(e) {
      if (e.target && e.target.id === 'clear-marks-btn') {
        clearSavedMarks();
      }
    });

    // Add event listener for when the DOM is fully loaded
    if (document.readyState === 'loading') {
      // Loading hasn't finished yet, wait for the DOMContentLoaded event
      document.addEventListener('DOMContentLoaded', initializeMarksEntrySystem);
    } else {
      // DOM is already ready, initialize immediately
      initializeMarksEntrySystem();
    }

    // Helper function to calculate grade from marks
    function calculateGradeFromMarks(marks) {
        // Primary school expectation-based grading scale (0-100)
        if (marks >= 85) return 'Exceeds Expectations';
        else if (marks >= 70) return 'Meets Expectations';
        else if (marks >= 55) return 'Approaches Expectations';
        else return 'Below Expectations';
    }

    // Function to save marks using student ID and term
    async function saveStudentMarks(studentId, term) {
        try {
            // Get form elements
            const studentSelect = document.getElementById('marks-student');
            const className = document.getElementById('marks-class').value;
            const teacherRemarks = document.getElementById('teacher-remarks').value;
            
            // Validate inputs
            if (!studentId || !term) {
                throw new Error('Please select both student and term');
            }
            
            // Collect marks
            const marks = [];
            const rows = document.querySelectorAll('#marks-entry-body tr');
            
            rows.forEach(row => {
                const marksInput = row.querySelector('input[type="number"]');
                const subjectId = marksInput.id.replace('marks-', '');
                const marksValue = marksInput.value ? parseFloat(marksInput.value) : 0;
                const grade = calculateGradeFromMarks(marksValue);
                
                marks.push({
                    subject: subjectId,
                    marks: marksValue,
                    grade: grade
                });
            });
            
            // Prepare data
            const marksData = {
                studentId: studentId,
                term: term,
                subjects: marks,
                teacherRemarks: teacherRemarks
            };
            
            // Save to localStorage
            const marksKey = `marks-${studentId}-${term}`;
            localStorage.setItem(marksKey, JSON.stringify(marksData));
            
            // Save to API
            const token = localStorage.getItem('token');
            if (token) {
                const endpoint = `${API_BASE_URL}/api/marks/students/${studentId}/marks`;
                console.log('Saving marks to:', endpoint);
                console.log('Request body:', {
                    studentId: studentId,
                    term: term,
                    subjects: marks,
                    teacherRemarks: teacherRemarks
                });
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        studentId: studentId,
                        term: term,
                        subjects: marks,
                        teacherRemarks: teacherRemarks
                    })
                });
                
                const data = await response.json();
                console.log('API response:', data);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`Failed to save marks: ${errorData.message || response.statusText || 'Unknown error'}`);
                }
                
                if (data.success) {
                    alert('Marks saved successfully to backend!');
                } else {
                    console.error('Backend save failed:', data);
                    throw new Error('Failed to save marks to backend');
                }
            } else {
                console.warn('No token found - saving only to localStorage');
                alert('Marks saved to local storage only. Please login again to save to backend.');
            }
            
            return true;
        } catch (error) {
            console.error('Error saving marks:', error);
            alert('Failed to save marks: ' + error.message);
            throw error;
        }
    }

    // Helper function to update report card preview
    function updateReportCardPreview(marksData) {
        try {
            // Get student info
            const studentSelect = document.getElementById('report-student');
            const selectedOption = studentSelect.options[studentSelect.selectedIndex];
            const studentName = selectedOption.text;
            const className = document.getElementById('report-class').value;
            const term = document.getElementById('report-term').value;

            // Calculate averages and grades
            let totalMarks = 0;
            let subjectCount = 0;
            marksData.subjects.forEach(subject => {
                if (typeof subject.marks === 'number') {
                    totalMarks += subject.marks;
                    subjectCount++;
                }
            });

            const averageScore = subjectCount > 0 ? (totalMarks / subjectCount).toFixed(2) : 0;
            const overallGrade = calculateGradeFromMarks(averageScore);

            // Update report card preview
            const previewContainer = document.getElementById('report-card-preview');
            if (previewContainer) {
                previewContainer.innerHTML = `
                    <div class="report-header">
                        <h2>ST. MARY'S PRIMARY SCHOOL</h2>
                        <h3>TERMLY REPORT CARD</h3>
                    </div>
                    <div class="student-info">
                        <p><strong>Student:</strong> ${studentName}</p>
                        <p><strong>Class:</strong> ${className}</p>
                        <p><strong>Term:</strong> ${term}</p>
                    </div>
                    <div class="marks-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Marks</th>
                                    <th>Grade</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${marksData.subjects.map(subject => `
                                    <tr>
                                        <td>${subject.subject}</td>
                                        <td>${subject.marks}</td>
                                        <td>${subject.grade}</td>
                                        <td>${getGradeRemarks(subject.grade)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="summary">
                        <p><strong>Total Marks:</strong> ${totalMarks}</p>
                        <p><strong>Average Score:</strong> ${averageScore}</p>
                        <p><strong>Overall Grade:</strong> ${overallGrade}</p>
                    </div>
                    <div class="teacher-remarks">
                        <h4>Teacher's Remarks:</h4>
                        <p>${marksData.teacherRemarks || 'Good progress this term. Keep up the good work!'}</p>
                    </div>
                    <div class="mt-4" style="text-align: center;">
                        <button id="download-pdf" class="btn btn-primary mr-2" style="display: none;">
                            <i class="fas fa-download"></i> Download Report Card
                        </button>
                        <button id="send-to-student" class="btn btn-success mr-2" style="display: none;">
                            <i class="fas fa-paper-plane"></i> Send to Student
                        </button>
                        <button id="delete-report" class="btn btn-danger" style="display: none;" 
                                data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                            <i class="fas fa-trash"></i> Delete Report Card
                        </button>
                    </div>
                    
                    <!-- Delete Confirmation Modal -->
                    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Confirm Deletion</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <p>Are you sure you want to delete this report card? This action cannot be undone.</p>
                                    <p class="text-danger">All marks and grades for this term will be permanently deleted.</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-danger" id="confirm-delete-btn">
                                        <i class="fas fa-trash"></i> Delete Permanently
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Add event listeners for download/send buttons
                const downloadBtn = document.getElementById('download-pdf');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', downloadReportCardAsPDF);
                }

                const sendBtn = document.getElementById('send-to-student');
                if (sendBtn) {
                    sendBtn.addEventListener('click', sendReportCardToStudent);
                }
            }
        } catch (error) {
            console.error('Error updating report card preview:', error);
            alert('Failed to update report card preview. Please try again.');
        }
    }

    // Initialize report card section
    async function initializeReportCardSection() {
        try {
            console.log('Initializing report card section...');
            
            // Get class select element
            const classSelect = document.getElementById('report-class');
            if (!classSelect) {
                console.error('Class select element not found');
                return;
            }
            console.log('Found class select:', classSelect);

            // Get student select element
            const studentSelect = document.getElementById('report-student');
            if (!studentSelect) {
                console.error('Student select element not found');
                return;
            }
            console.log('Found student select:', studentSelect);

            // Get generate report card button
            const generateReportBtn = document.getElementById('generate-report-card');
            if (!generateReportBtn) {
                console.error('Generate report card button not found');
                return;
            }
            console.log('Found generate report card button:', generateReportBtn);

            // Add event listener for class selection
            classSelect.addEventListener('change', async function() {
                const selectedClass = this.value;
                console.log('Class selection changed to:', selectedClass);
                
                if (!selectedClass) {
                    console.log('No class selected');
                    return;
                }

                // Clear existing students
                studentSelect.innerHTML = '<option value="">-- Select a student --</option>';
                
                // Load students for selected class
                try {
                    console.log('Attempting to load students for class:', selectedClass);
                    const students = await loadStudentsForClass(selectedClass);
                    
                    if (students && students.length > 0) {
                        console.log('Successfully loaded', students.length, 'students');
                        
                        // Update student dropdown
                        students.forEach(student => {
                            const option = document.createElement('option');
                            option.value = student.id;
                            option.textContent = student.name;
                            studentSelect.appendChild(option);
                        });
                    } else {
                        console.log('No students found for class:', selectedClass);
                        alert('No students found in this class');
                    }
                } catch (error) {
                    console.error('Error loading students:', error);
                    alert('Failed to load students for this class: ' + error.message);
                }
            });

            // Initialize with current class if selected
            const currentClass = classSelect.value;
            if (currentClass) {
                console.log('Initializing with current class:', currentClass);
                classSelect.dispatchEvent(new Event('change'));
            }
        } catch (error) {
            console.error('Error initializing report card section:', error);
        }
    }
</script>


  <!-- Report Card Section -->
  <section id="report-card-section" class="tab-section">
    <h2>Report Card</h2>
    <div class="report-card-container">
      <div class="form-section">
        <div class="form-group">
          <label for="report-student">Select Student</label>
          <select id="report-student" class="form-control">
            <option value="">-- Select a student --</option>
          </select>
        </div>
        <div class="form-group">
          <label for="report-term">Select Term</label>
          <select id="report-term" class="form-control">
            <option value="Term 1">Term 1</option>
            <option value="Term 2">Term 2</option>
            <option value="Term 3">Term 3</option>
          </select>
        </div>
        <div class="form-group">
          <button class="btn btn-primary" id="generate-report-card">
            <i class="fas fa-file-pdf"></i> Generate Report Card
          </button>
        </div>
      </div>

      <!-- Report Card Preview -->
      <div class="preview-section">
        <div class="report-header">
          <h3>Student Report Card</h3>
          <div class="student-info">
            <p><strong>Name:</strong> <span id="student-name">N/A</span></p>
            <p><strong>Class:</strong> <span id="student-class">N/A</span></p>
            <p><strong>Admission No:</strong> <span id="admission-no">N/A</span></p>
            <p><strong>Term:</strong> <span id="term-display">N/A</span></p>
          </div>
        </div>

        <div class="marks-table">
          <table>
            <thead>
              <tr>
                <th>Subject</th>
                <th>Marks</th>
                <th>Grade</th>
                <th>Remarks</th>
              </tr>
            </thead>
            <tbody id="marks-table-body">
              <!-- Marks will be populated here -->
            </tbody>
          </table>
        </div>

        <div class="summary-section">
          <p><strong>Total Marks:</strong> <span id="total-marks">N/A</span></p>
          <p><strong>Average Score:</strong> <span id="average-score">N/A</span></p>
          <p><strong>Overall Grade:</strong> <span id="overall-grade">N/A</span></p>
          <p><strong>Teacher's Remarks:</strong> <span id="teacher-remarks-preview">N/A</span></p>
        </div>

        <div class="report-actions">
          <button id="download-pdf" class="btn btn-success" style="display: none;">
            <i class="fas fa-download"></i> Download PDF
          </button>
          <button id="send-to-student" class="btn btn-info" style="display: none;">
            <i class="fas fa-envelope"></i> Send to Student
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Save marks button handler -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Save marks button
        const saveMarksBtn = document.getElementById('save-marks-btn');
        if (saveMarksBtn) {
            saveMarksBtn.addEventListener('click', async function() {
                try {
                    const studentId = document.getElementById('marks-student').value;
                    const term = document.getElementById('marks-term').value;
                    await saveStudentMarks(studentId, term);
                } catch (error) {
                    console.error('Error saving marks:', error);
                    alert('Failed to save marks. Please try again.');
                }
            });
        }
        
        // Log if report card section was initialized
        console.log('DOM fully loaded, report card section should be initialized');
    });
  </script>
  
  <!-- Report Cards JavaScript -->
  <script src="../js/report-cards.js"></script>
  </main>
</body>
</html>
